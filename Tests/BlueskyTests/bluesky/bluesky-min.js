/* This Source Code Form is subject to the terms of the Mozilla Public
* License, v. 2.0. If a copy of the MPL was not distributed with this
* file, You can obtain one at http://mozilla.org/MPL/2.0/. */

// Copyright 2012, Jeff Simon (www.bluesky.io).  Date: 7/23/2012

"use strict";function _xmlToJSON(n){var r=function(n){var i={},t;for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},i=function(n,t,u){var s="",c,e,f,o,l;if(t instanceof Array){for(c=0;c<t.length;c++)s+=i(n,t[c],r(u));return s}if(t&&typeof t=="object"){var a="<"+n,h="",v="";if(t["@xmlns"]){e=t["@xmlns"];for(f in e)e.hasOwnProperty(f)&&(f==="$"?u[f]!==e[f]&&(h+=' xmlns="'+e[f]+'"',u[f]=e[f]):u[f]&&u[f]===e[f]||(h+=" xmlns:"+f+'="'+e[f]+'"',u[f]=e[f]))}for(o in t)t.hasOwnProperty(o)&&o!=="@xmlns"&&(l=t[o],o==="$"?v+=l:o.indexOf("@")===0?h+=" "+o.substring(1)+'="'+l+'"':s+=i(o,l,r(u)));return s=v+s,s!==""?a+h+">"+s+"<\/"+n+">":a+h+"/>"}},t;for(t in n)if(n.hasOwnProperty(t)&&t.indexOf("@")==-1)return i(t,n[t],{});return null}function msSetImmediate(n){WinJS.Promise.timeout().then(function(){n()})}var WinJS={Namespace:{define:function(n,t){return this.defineWithParent(window,n,t)},defineWithParent:function(n,t,i){for(var r=n,e=t.split("."),f,u=0,o=e.length;u<o;u++)f=e[u],r[f]||Object.defineProperty(r,f,{value:{},writable:!1,enumerable:!0,configurable:!0}),r=r[f];return i&&WinJS._initializeMembers(r,i),r}},Class:{define:function(n,t,i){return n=n||function(){},t&&WinJS._initializeMembers(n.prototype,t),i&&WinJS._initializeMembers(n,i),n},derive:function(n,t,i,r){return t=t||function(){},t.prototype=Object.create(n.prototype),Object.defineProperty(t.prototype,"constructor",{value:t}),WinJS.Class.define(t,i,r),t},mix:function(n,t){return t&&WinJS._initializeMembers(n.prototype,t),n}},_initializeMembers:function(n,t){var u={},r,i;for(r in t)(i=t[r],i!=null)&&(i.enumerable=!0,typeof i=="object"&&(typeof i.get=="function"||typeof i.set=="function")?u[r]=i:n[r]=i);u!={}&&Object.defineProperties(n,u)},strictProcessing:function(){}},setImmediate,Bluesky,blueskyUtils;WinJS.Namespace.define("WinJS.UI",{DOMEventMixin:{addEventListener:function(n,t,i){this.element.addEventListener(n,t,i)},removeEventListener:function(n,t){this.element.removeEventListener(n,t)},dispatchEvent:function(n,t){var i=document.createEvent("Event");return i.initEvent(n,!1,!1),t&&(i.detail=t.detail),this.element.dispatchEvent(i)}}}),WinJS.Namespace.define("WinJS",{xhr:function(n){var t,i=n&&n.type||"GET";return Bluesky.Settings.ProxyCrossDomainXhrCalls?new WinJS.Promise(function(t,r){var f=n.url.toLowerCase().indexOf("http://")!=0;f||(n.url="http://query.yahooapis.com/v1/public/yql?q=use%20%22http%3A%2F%2Fbluesky.io%2Fyqlproxy.xml%22%20as%20yqlproxy%3Bselect%20*%20from%20yqlproxy%20where%20url%3D%22"+encodeURIComponent(n.url)+"%22%3B&format=json&callback="),$.ajax({url:n.url,data:n.data,success:function(n,i,r){var u,e,o;if(f)e=r.responseText,o=r.responseXML||null;else if(u=$.parseJSON(r.responseText).query.results,u.xml)var o="<xml>"+_xmlToJSON(u.xml)+"<\/xml>",s=new DOMParser,o=s.parseFromString(o,"application/xml");else e=u.xml||u.result,o=null;t({responseType:"",responseText:e,response:e,responseXML:o,readyState:4,DONE:4,statusText:r.statusText,status:r.status})},error:function(n){n.status==404?r({number:-2146697211}):r({number:1})},type:i})}):new WinJS.Promise(function(r,u){var e=!1;t=new XMLHttpRequest,t.onreadystatechange=function(){t.cancelled||e||t.readyState==4&&(t.status>=200&&t.status<300?r(t):u(t),e=!0)},t.open(i,n.url,!0),n.headers&&n.headers.forEach(function(n){t.setRequestHeader(key,n)}),t.send(n.data)},function(){t.cancelled=!0,t.abort()})}}),WinJS.Namespace.define("Windows",{UI:{ViewManagement:{ApplicationView:{value:null},ApplicationViewState:{view:{value:this.filled},fullScreenLandscape:0,filled:1,snapped:2,fullScreenPortrait:3}}},ApplicationModel:{isWeb:!0,Activation:{ActivationKind:{launch:0},ApplicationExecutionState:{terminated:0}}},Graphics:{Display:{DisplayProperties:{}}}}),WinJS.Namespace.define("Windows.Foundation",{Uri:WinJS.Class.define(function(n){this.uri=n},{})}),WinJS.Namespace.define("Windows.Foundation.Collections",{IVectorView:WinJS.Class.define(function(){this._items=[]},{getAt:function(n){return n<this._items.length?this._items[n]:null},getMany:function(){console.error("IVector.getMany NYI")},indexOf:function(n){return this._items.indexOf(n)},size:function(){return this._items.length}})}),WinJS.Namespace.define("Windows.Foundation.Collections",{IVector:WinJS.Class.derive(Windows.Foundation.Collections.IVectorView,function(){this._items=[]},{append:function(n){this._items.push(n)},clear:function(){this._items=[]},getAt:function(n){return n<this._items.length?this._items[n]:null},getMany:function(){console.error("IVector.getMany NYI")},getView:function(){console.error("IVector.getView NYI")},indexOf:function(n){return this._items.indexOf(n)},insertAt:function(n,t){return this._items.splice(n,0,t)},removeAt:function(n){this._items.splice(n,1)},removeAtEnd:function(){return this._items.pop()},replaceAll:function(n){this._items.clear(),n.forEach(function(n){this._items.append(n)})},setAt:function(n,t){n<this._items.length&&(this._items[n]=t)},size:function(){return this._items.length}})}),WinJS.Namespace.define("Windows.Globalization.DateTimeFormatting",{DateTimeFormatter:WinJS.Class.define(function(n){this._formatTemplate=n},{format:function(n){return this._formatTemplate=="hour minute"?n.toLocaleString():""}})}),WinJS.Namespace.define("Windows.System.Launcher",{launchUriAsync:function(n){document.location.href=n.uri}}),WinJS.Namespace.define("WinJS.Application",{IsBluesky:!0,start:function(){var n=[],t=function(t){n.push(t)},i=this;WinJS.Promise.timeout().then(function(){return i._notifyLoaded({setPromise:t}),n.length>0?WinJS.Promise.join(n):void 0}).then(function(){var r=new WinJS.Promise(function(n){$(document).ready(function(){n()})});return r.then(function(){var r={arguments:"",kind:Windows.ApplicationModel.Activation.ActivationKind.launch,previousExecutionState:null,target:null,setPromise:t,activatedOperation:new Windows.UI.WebUI.ActivatedOperation};return r.detail=[r],n=[],i._notifyActivated(r),n.length>0?WinJS.Promise.join(n):void 0}).then(function(){if(Windows.UI.WebUI._activationDeferrals.length>0)return WinJS.Promise.join(Windows.UI.WebUI._activationDeferrals)}).then(function(){i._notifyReady({setPromise:t})})})},stop:function(){},addEventListener:function(n,t){WinJS.Application._eventListeners[n].push(t)},removeEventListener:function(n,t){for(var r=WinJS.Application._eventListeners[n],i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);return}},_notifyActivated:function(n){var i={target:this,type:"activated",detail:n,setPromise:n.setPromise,getDeferral:Windows.UI.WebUI.ActivatedOperation.getDeferral},t;for(t in this._eventListeners.activated)this._eventListeners.activated[t](i)},_notifyLoaded:function(n){var i={target:this,type:"loaded",setPromise:n.setPromise},t;for(t in this._eventListeners.loaded)this._eventListeners.loaded[t](i)},_notifyReady:function(n){var i={target:this,type:"ready",setPromise:n.setPromise},t;for(t in this._eventListeners.ready)this._eventListeners.ready[t](i)},onactivated:{get:function(){return WinJS.Application._eventListeners.activated},set:function(n){WinJS.Application.addEventListener("activated",n)}},onloaded:{get:function(){return WinJS.Application._eventListeners.loaded},set:function(n){WinJS.Application.addEventListener("loaded",n)}},onready:{get:function(){return WinJS.Application._eventListeners.ready},set:function(n){WinJS.Application.addEventListener("ready",n)}},_eventListeners:{loaded:[],activated:[],ready:[],checkpoint:[],error:[],settings:[],unloaded:[]},sessionState:{}}),WinJS.Namespace.define("WinJS.Navigation",{_init:function(){},navigate:function(n,t){var i=this;return new WinJS.Promise(function(r){var e=null,o=null,f=null,u={location:n,state:t,defaultPrevented:!1};u.setPromise=function(n){e=n},i._notifyBeforeNavigate(u),WinJS.Promise.as(e).then(function(){if(u.defaultPrevented)return!1;u.setPromise=function(n){o=n},i._notifyNavigating(u)}).then(function(){return WinJS.Promise.as(o)}).then(function(){i.curPageInfo&&i.curPageInfo.location!=""&&i.backStack.push(i.curPageInfo),i.curPageInfo=u,u.setPromise=function(n){f=n},i._notifyNavigated(i.curPageInfo),f?WinJS.Promise.as(f).then(function(){r()}):r()})})},back:function(){if(this.backStack.length==0)return new WinJS.Promise.as(null);var t=this.backStack[this.backStack.length-1],n=this;return new WinJS.Promise(function(i){var f=null,e=null,u=null,r={location:t.location,state:t.state,defaultPrevented:!1};r.setPromise=function(n){f=n},n._notifyBeforeNavigate(r),WinJS.Promise.as(f).then(function(){if(r.defaultPrevented)return!1;r.setPromise=function(n){e=n},n._notifyNavigating(r)}).then(function(){return WinJS.Promise.as(e)}).then(function(){n.backStack.pop(),n.forwardStack.push(n.curPageInfo),n.curPageInfo=t,n.curPageInfo.setPromise=function(n){u=n},n._notifyNavigated(n.curPageInfo),u?WinJS.Promise.as(u).then(function(){i()}):i()})})},forward:function(){if(this.forwardStack.length==0)return new WinJS.Promise.as(null);var t=this.forwardStack[this.forwardStack.length-1],n=this;return new WinJS.Promise(function(i){var f=null,e=null,u=null,r={location:t.location,state:t.state,defaultPrevented:!1};r.setPromise=function(n){f=n},n._notifyBeforeNavigate(r),WinJS.Promise.as(f).then(function(){if(r.defaultPrevented)return!1;r.setPromise=function(n){e=n},n._notifyNavigating(r)}).then(function(){return WinJS.Promise.as(e)}).then(function(){n.forwardStack.pop(),n.backStack.push(n.curPageInfo),n.curPageInfo=t,n.curPageInfo.setPromise=function(n){u=n},n._notifyNavigated(n.curPageInfo),u?WinJS.Promise.as(u).then(function(){i()}):i()})})},canGoBack:{get:function(){return this.backStack.length>0}},canGoForward:{get:function(){return this.forwardStack.length>0}},backStack:[],forwardStack:[],curPageInfo:null,addEventListener:function(n,t){this._eventListeners[n].push(t)},removeEventListener:function(n,t){for(var r=this._eventListeners[n],i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);return}},_notifyBeforeNavigate:function(n){var t={target:this,type:"beforenavigate",detail:n},i;for(i in this._eventListeners.beforenavigate)this._eventListeners.beforenavigate[i](t);n.defaultPrevented=t.defaultPrevented},_notifyNavigating:function(n){var i={target:this,type:"navigating",detail:n},t;for(t in this._eventListeners.navigating)this._eventListeners.navigating[t](i)},_notifyNavigated:function(n){var i={target:this,type:"navigated",detail:n},t;for(t in this._eventListeners.navigated)this._eventListeners.navigated[t](i)},onbeforenavigate:{get:function(){return this._eventListeners.beforenavigate},set:function(n){this.addEventListener("beforenavigate",n)}},onnavigating:{get:function(){return this._eventListeners.navigating},set:function(n){this.addEventListener("navigating",n)}},onnavigated:{get:function(){return this._eventListeners.navigated},set:function(n){this.addEventListener("navigated",n)}},_eventListeners:{beforenavigate:[],navigating:[],navigated:[]},history:{get:function(){return{backStack:this.backStack,forwardStack:this.forwardStack,current:this.curPageInfo?this.curPageInfo.location:""}},set:function(n){n&&n!={}?(this.backStack=n.backStack?n.backStack.slice():[],this.forwardStack=n.forwardStack?n.forwardStack.slice():[],this.curPageInfo.location=n.current&&n.current.location?n.current.location:""):(this.backStack=[],this.forwardStack=[],this.curPageInfo=null)}},location:{get:function(){return this.curPageInfo?this.curPageInfo.location:null},set:function(n){this.curPageInfo.location=n}},state:{get:function(){return this.curPageInfo.state},set:function(n){this.curPageInfo.state=n}}}),WinJS.Namespace.define("WinJS.Resources",function(){},{processAll:function(){throw"nyi";},getString:function(){throw"nyi";},oncontextchanged:{get:function(){return this._eventListeners.contextchanged},set:function(n){this.addEventListener("contextchanged",n)}}}),WinJS.Namespace.define("WinJS",{Promise:WinJS.Class.define(function(n){this._thenPromises=[],this._completed=!1,this._completedWithError=!1,this._completedValue=null,this._onThenComplete=null,this._onThenError=null,this._onThenProgress=null,this._thenCompletes=[];var i=this;n(function(n){i._complete(n)},function(n){i._error&&i._error(n)},function(n){i._progress&&i._progress(n)})},{then:function(n,t,i){if(!n)return this._completedValue;if(this._completed)return new WinJS.Promise.as(n(this._completedValue));if(this._completedWithError)return t?new WinJS.Promise.as(t(this._completedValue)):this._completedValue;var r=new WinJS.Promise(function(){});return r._thenComplete=n,r._thenError=t,r._thenProgress=i,this._thenPromises.push(r),r},_complete:function(n){this._completed=!0,this._completedValue=n,this._thenPromises.forEach(function(t){var r=t._thenComplete(n),i=WinJS.Promise.as(r);i&&i.then(function(n){t._complete(n)})})},_error:function(n){this._completedWithError=!0,this._completedValue=n,this._thenPromises.forEach(function(t){if(t._thenError){var r=t._thenError(n),i=WinJS.Promise.as(r);i&&i.then(function(n){t._error(n)},function(n){t._error(n)})}})},done:function(n,t,i){return blueskyUtils._warnedDoneNYI||(console.warn("Promise.done is NYI; replacing with .then()"),blueskyUtils._warnedDoneNYI=!0),this.then(n,t,i)}},{timeout:function(n){return n||(n=1),new WinJS.Promise(function(t){setTimeout(t,n)})},as:function(n){return WinJS.Promise.is(n)?n:new WinJS.Promise(function(t){t(n)})},wrap:function(n){return new WinJS.Promise(function(t){t(n)})},is:function(n){return n&&n.then&&typeof n.then=="function"},join:function(n){return new WinJS.Promise(function(t){var u=[],f,e;n&&n.length!=0?(n.length||(n=[n]),f=n.length,e=function(){--f==0&&t(u)},n.forEach(function(n){n.then(function(t){u.push(t),e(n)})})):t(u)})}})}),WinJS.Namespace.defineWithParent(WinJS,"Binding",{as:function(n){if(typeof n=="object"){var t=WinJS.Binding.define(n);return new t(n)}return n},define:function(n){var t=WinJS.Class.define(function(n){this.sourceData=n||{};for(var t in n)try{this.sourceData[t]=n[t]}catch(i){}},{bind:function(n,t){return(this.listeners[n]=this.listeners[n]||[],this.listeners[n].indexOf(t)>=0)?this:(this.listeners[n].push(t),this)},getProperty:function(n){return WinJS.Binding.as(this.sourceData[n])},setProperty:function(n,t){return this.updateProperty(n,t),this},updateProperty:function(n,t){var r=this.sourceData[n],i=WinJS.Binding.unwrap(t);return i==r?WinJS.Promise.as():(this.sourceData[n]=i,this.notify(n,i,r))},notify:function(n,t,i){if(!this.listeners[n])return WinJS.Promise.as();var r=this;return WinJS.Promise.timeout().then(function(){r.listeners[n].forEach(function(n){n(t,i)})}).then(function(){return t})},sourceData:{},listeners:{}});return WinJS.Class.mix(t,WinJS.Binding.expandProperties(n)),t},unwrap:function(n){return n&&n.sourceData?n.sourceData:n},expandProperties:function(n){for(var t={};n;)Object.keys(n).forEach(function(n){t[n]={get:function(){return this.getProperty(n)},set:function(t){return this.setProperty(n,t)},enumerable:!0,configurable:!0}}),n=Object.getPrototypeOf(n);return t},processAll:function(n,t){return new WinJS.Promise(function(i){$("[data-win-bind]",n).each(function(){var n,i;blueskyUtils.ensureDatasetReady(this),n=blueskyUtils.convertDeclarativeDataStringToJavascriptObject(this.dataset.winBind);for(i in n)WinJS.Binding._bindField(this,i,n[i],t)}),i()})},_bindField:function(n,t,i,r){if(r.bind!=undefined){var u=n;r.bind(i,function(){WinJS.Binding._updateBoundValue(u,t,r[i])})}WinJS.Binding._updateBoundValue(n,t,r[i])},_updateBoundValue:function(n,t,i){if(t.indexOf(".")>=0){var r=t.split(".");n[r[0]][r[1]]=i}else t=="innerText"&&(t="textContent"),n[t]=i}}),WinJS.Namespace.define("WinJS.Binding",{_ListBase:WinJS.Class.define(function(){},{getAt:function(n){return this.getItem(n).data},_getValues:function(){for(var t=[],i,n=0;n<this.length;n++)i=this.getItem(n),i&&(t[n]=this.getItem(n).data);return t},concat:function(n){return this._getValues().concat(n)},join:function(n){return this._getValues().join(n||",")},forEach:function(n,t){this._getValues().forEach(n,t)},map:function(n,t){return this._getValues().map(n,t)},some:function(n,t){return this._getValues().some(n,t)},every:function(n,t){return this._getValues().every(n,t)},reduce:function(n,t){return this._getValues().reduce(n,t)},reduceRight:function(n,t){return this._getValues().reduceRight(n,t)},indexOf:function(n,t){return this._getValues().indexOf(n,t)},lastIndexOf:function(n,t){var i=this._getValues();return t===undefined&&(t=i.length-1),i.lastIndexOf(n,t)},slice:function(n,t){return this._getValues().slice(n,t)},filter:function(n,t){return this._getValues().filter(n,t)},createFiltered:function(n){return new WinJS.Binding.FilteredListProjection(this,n)},createGrouped:function(n,t){return new WinJS.Binding.GroupedSortedListProjection(this,n,t)},copyItem:function(n){return{key:n.key,data:n.data,groupKey:n.groupKey,groupSize:n.groupSize}},addEventListener:function(n,t){this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push(t)},removeEventListener:function(n,t){for(var r=this._eventListeners[n],i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);return}},_notifyItemChanged:function(n){var i={target:this,type:"itemchanged",detail:n},t;for(t in this._eventListeners.itemchanged)this._eventListeners.itemchanged[t](i)},_notifyItemRemoved:function(n){var i={target:this,type:"itemremoved",detail:n},t;for(t in this._eventListeners.itemremoved)this._eventListeners.itemremoved[t](i)},_notifyItemInserted:function(n){var i={target:this,type:"iteminserted",detail:n},t;for(t in this._eventListeners.iteminserted)this._eventListeners.iteminserted[t](i)},oniteminserted:{get:function(){return this._eventListeners.iteminserted},set:function(n){this.addEventListener("iteminserted",n)}},onitemchanged:{get:function(){return this._eventListeners.itemchanged},set:function(n){this.addEventListener("itemchanged",n)}},onitemremoved:{get:function(){return this._eventListeners.itemremoved},set:function(n){this.addEventListener("itemremoved",n)}},onitemmoved:{get:function(){return this._eventListeners.itemmoved},set:function(n){this.addEventListener("itemmoved",n)}},onreload:{get:function(){return this._eventListeners.reload},set:function(n){this.addEventListener("reload",n)}},onitemmutated:{get:function(){return this._eventListeners.itemmutated},set:function(n){this.addEventListener("itemmutated",n)}}})}),WinJS.Namespace.define("WinJS.Binding",{_ModifiableListBase:WinJS.Class.derive(WinJS.Binding._ListBase,null,{push:function(n){var t=this._addValue(n);this._notifyItemInserted({key:t,index:this.length,value:n})},pop:function(){var n=this.splice(-1,1);return n&&n.length>=1?n[0]:null},shift:function(){return this.splice(0,1)[0]},_getNewKey:function(){return this._currentKey++}})}),WinJS.Namespace.define("WinJS.Binding",{List:WinJS.Class.derive(WinJS.Binding._ModifiableListBase,function(n,t){if(this._eventListeners=[],this._items={},this._keys=[],this._currentKey=0,n)for(var i in n)this._addValue(n[i]);t&&WinJS.UI.setOptions(t),this.dataSource=new WinJS.UI.IListDataSource(this,this._items)},{splice:function(n,t){var s=[],o,f,u,r;for(n<0&&(n+=this.length);t>0;){var e=this._keys[n],h=this._items[e],c=h.data;this._keys.splice(n,1),s.push(c),this._notifyItemRemoved({key:e,value:c,item:h,index:n}),delete this._items[e],t--}if(arguments.length>2)for(r=2;r<arguments.length;r++)o=arguments[r],this.binding&&(value=WinJS.Binding.as(value)),f=Math.min(n+r-2,this.length),u=this._getNewKey(),this._items[u]={key:u,data:o,index:f},this._keys.splice(f,0,u),this._notifyItemInserted({key:u,index:f,value:o});for(r=n;r<this.length;r++)this.getItem(r).index=r;return s},_spliceAtKey:function(n){var i=Array.prototype.slice.call(arguments);return i[0]=this._keys.indexOf(n),this.splice.apply(this,i)},shift:function(){return this.splice(0,1)[0]},indexOfKey:function(n){return this._keys.indexOf(n)},_addValue:function(n){var t=this._getNewKey();return this.binding&&(n=WinJS.Binding.as(n)),this._items[t]={key:t,data:n,index:this._keys.length},this._keys.push(t),t},setAt:function(n,t){if(n==this.length)this.push(t);else if(n<this.length){this.binding&&(t=WinJS.Binding.as(t));var r=this._keys[n],u=this._items[r],i=this.copyItem(u);i.data=t,i.index=n,this._items[r]=i,this._notifyItemChanged({key:r,index:n,oldValue:u.data,newValue:t,oldItem:u,newItem:i})}},length:{get:function(){return this._keys.length},set:function(n){n<this._keys.length&&this.splice(n,this._keys.length-n)}},getItem:function(n){return this.getItemFromKey(this._keys[n])},getItemFromKey:function(n){return this._items[n]}})}),WinJS.Namespace.define("WinJS.Binding",{_ListProjection:WinJS.Class.derive(WinJS.Binding._ModifiableListBase,null,{getItemFromKey:function(n){return this._list._items[n]},splice:function(n){var r=Array.prototype.slice.call(arguments);return n==this.length||n==-1?(r[0]=this._list.length-1,this._list.splice.apply(this._list,r)):(r[0]=this.getItem(n).key,this._spliceAtKey.apply(this,r))}})}),WinJS.Namespace.define("WinJS.Binding",{FilteredListProjection:WinJS.Class.derive(WinJS.Binding._ListProjection,function(n,t){var i,r;for(this._filteredKeys=[],this._list=n,this._currentKey=0,this._inclusionCallback=t,i=0;i<n.length;i++)r=n.getItem(i),t(r.data)&&this._filteredKeys.push(r.key);this._eventListeners=[],this._list.addEventListener("iteminserted",this._itemInserted.bind(this)),this._list.addEventListener("itemremoved",this._itemRemoved.bind(this)),this._list.addEventListener("itemchanged",this._itemChanged.bind(this)),this.dataSource=new WinJS.UI.IListDataSource(this,this._filteredKeys)},{indexOf:function(n){return this._filteredKeys.indexOf(n.key)},length:{get:function(){return this._filteredKeys.length}},getItem:function(n){return this.getItemFromKey(this._filteredKeys[n])},getItemFromKey:function(n){return this._list.getItemFromKey(n)},_spliceAtKey:function(n,t){var r,u,i,o;if(arguments.length>2&&(r=Array.prototype.slice.call(arguments),r[1]=0,this._list._spliceAtKey.apply(this._list,r)),u=[],t){var f=[],e=this._filteredKeys.indexOf(n),s=this._filteredKeys.length&&i-e<t;for(i=e;i<s;i++)f.push(this._filteredKeys[i]);o=this._list,f.forEach(function(n){u.push(o._spliceAtKey(n,1)[0])})}return u},setAt:function(n,t){var i=this._list.indexOfKey(this._filteredKeys[n]);this._list.setAt(i,t)},indexOfKey:function(n){return this._filteredKeys.indexOf(n)},_itemInserted:function(n){var i,r,t,u,f;if(this._inclusionCallback(n.detail.value)){for(r=n.detail.index;--r>=0;)if(t=this._list.getItem(r),t&&this._inclusionCallback(t.data)){i=t.key;break}u=i!==undefined?this._filteredKeys.indexOf(i)+1:0,this._filteredKeys.splice(u,0,n.detail.key),f={value:n.detail.value,key:n.detail.key,index:u},this._notifyItemInserted(f)}},_itemRemoved:function(n){var i=n.detail.key,t=this._filteredKeys.indexOf(i);t>=0&&(this._filteredKeys.splice(t,1),this._notifyItemRemoved(n.detail))},_itemChanged:function(n){this._notifyItemChanged(n.detail)}})}),WinJS.Namespace.define("WinJS.Binding",{GroupedSortedListProjection:WinJS.Class.derive(WinJS.Binding._ListProjection,function(n,t,i){var r,u;for(this._groupedItems=[],this._groupsProjection=null,this._sortedKeys=[],this._list=n,this._eventListeners=[],this._groupKeySelector=t,this._groupDataSelector=i,this._list.addEventListener("iteminserted",this._itemInserted.bind(this)),this._list.addEventListener("itemremoved",this._itemRemoved.bind(this)),this._list.addEventListener("itemchanged",this._itemChanged.bind(this)),this._sortedKeys=[],r=0;r<n.length;r++)u=n.getItem(r),this._sortedKeys.push(u.key);for(this._sortKeys(),r=0;r<n.length;r++)u=n.getItem(r),u=this.copyItem(u),u.groupKey=t(u.data),this._addItem(u);this.dataSource=new WinJS.UI.IListDataSource(this,this._groupedItems)},{indexOf:function(n){return this._sortedKeys.indexOf(n.key)},_sortKeys:function(){var n=this;this._sortedKeys.sort(function(t,i){return(t=n._groupKeySelector(n._list.getItemFromKey(t).data),i=n._groupKeySelector(n._list.getItemFromKey(i).data),t<i)?-1:t==i?0:1})},_addItem:function(n){var t=this._groupKeySelector(n.data),i={data:n.data,groupKey:t,key:n.key};this._groupedItems[n.key]=i},length:{get:function(){return this._sortedKeys.length}},getItem:function(n){var t=this._sortedKeys[n];return this.getItemFromKey(t)},getItemFromKey:function(n){return this._groupedItems[n]},indexOfKey:function(n){return this._sortedKeys.indexOf(n)},_itemInserted:function(n){this._addItem({data:n.detail.value,key:n.detail.key}),this._sortedKeys.push(n.detail.key),this._sortKeys(),n.detail.index=this.indexOfKey(n.detail.key),this._notifyItemInserted(n.detail)},_itemRemoved:function(n){var t=n.detail.key,r=n.detail.value,f=n.detail.item,u=this._groupedItems[t],i=this._sortedKeys.indexOf(t);delete this._groupedItems[t],this._sortedKeys.splice(i,1),this._notifyItemRemoved({key:t,value:r,index:i,item:u})},_itemChanged:function(n){var t=n.detail.key,u=n.detail.newValue,i=this._groupedItems[t],r={key:i.key,data:u,groupKey:this._groupKeySelector(u),groupSize:i.groupSize},f;this._groupedItems[t]=r,i.groupKey===r.groupKey?this._notifyItemChanged({key:t,index:this.indexOfKey(t),oldValue:i.data,newValue:r.data,oldItem:i,newItem:r}):(f=this._sortedKeys.indexOf(t),this._sortedKeys.splice(f,1),this._notifyItemRemoved({key:t,value:i.data,index:f,item:i}),this._sortedKeys.push(t),this._sortKeys(),this._notifyItemInserted({key:t,index:this.indexOfKey(t),value:u}))},groups:{get:function(){return this._groupsProjection==null&&(this._groupsProjection=new WinJS.Binding.GroupsListProjection(this)),this._groupsProjection}}})}),WinJS.Namespace.define("WinJS.Binding",{GroupsListProjection:WinJS.Class.derive(WinJS.Binding._ListProjection,function(n){var t,r;for(this._list=n,this._groupItems=[],this._groupKeys=[],this._eventListeners=[],this._list.addEventListener("iteminserted",this._itemInserted.bind(this)),this._list.addEventListener("itemremoved",this._itemRemoved.bind(this)),t=0;t<n.length;t++){var u=n.getItem(t),i=u.groupKey,f=!1;for(r in this._groupItems)if(this._groupItems[r].key==i){this._groupItems[r].groupSize++,f=!0;break}f||(this._groupItems[i]={key:i,groupSize:1,data:n._groupDataSelector(u.data)},this._groupKeys.push(i))}this.dataSource=new WinJS.UI.IListDataSource(this,this._groupItems)},{_itemInserted:function(n){var t=this._list.getItemFromKey(n.detail.key).groupKey,r=this._groupItems[t],i;r?r.groupSize++:(this._groupKeys.push(t),this._sortKeys(),i={key:t,groupSize:1,data:this._list._groupDataSelector(n.value)},this._groupItems[t]=i,this._notifyItemInserted({key:i.key,value:i.data}))},_itemRemoved:function(n){var i=n.detail.item.groupKey,t=this._groupItems[i],r=this._groupKeys.indexOf(i);t.groupSize==1?(this._groupKeys.splice(r,1),delete this._groupItems[i],this._notifyItemRemoved(i,r,t.data,t)):(t.groupSize--,this._notifyItemChanged(i,r,t.data,t.data,t,t))},_sortKeys:function(){var n=this;this._groupKeys.sort(function(n,t){return n<t?-1:n==t?0:1})},length:{get:function(){return this._groupKeys.length}},getItem:function(n){var t=this._groupKeys[n];return this.getItemFromKey(t)},getItemFromKey:function(n){for(var t in this._groupItems)if(this._groupItems[t].key==n)return this._groupItems[t];return null},indexOfKey:function(n){return this._groupKeys.indexOf(n)}})}),WinJS.Namespace.define("WinJS.Binding",{Template:WinJS.Class.define(function(n,t){n||(n=$("<div><\/div>")[0]),this.element=n,$(this.element).hide(),t&&WinJS.UI.setOptions(this,t)},{render:function(n,t){var i=this,r=function(n,i){var u=$(t||"<div><\/div>"),r;return u.addClass("win-template"),r=$(n).clone(),blueskyUtils.setDOMElementUniqueId(r[0]),WinJS.Binding.processAll(r,i).then(function(){return u.append(r.children()),u[0]})},u=new WinJS.Promise(function(n){i.href?$.get(i.href,function(t){n('<div data-win-control="WinJS.Binding.Template">'+t+"<\/div>")}):n(i.element)}),f=Math.max(0,i.processTimeout||0),e=WinJS.Promise.timeout(f).then(function(){return n}).then(function(n){return u.then(function(t){return r(t,n).then(function(n){return n})})});return{element:this.element,renderComplete:e}},renderItem:function(n,t){var i=n.then(function(n){return n.data});return this.render(i,t)}})}),WinJS.Namespace.define("WinJS.UI",{setOptions:function(n,t){var i,r;if(t)for(i in t)r=t[i],i.toLowerCase().indexOf("on")==0&&n.addEventListener?typeof r=="function"?n.addEventListener(i.substr(2),r):n.addEventListener(i.substr(2),eval(r)):n[i]=t[i]},process:function(n){return new WinJS.Promise(function(t){blueskyUtils.ensureDatasetReady(n),n.dataset&&n.dataset.winControl&&WinJS.UI._processElement(n),$("[data-win-control]",n).each(function(){blueskyUtils.ensureDatasetReady(this),this.dataset&&this.dataset.winControl&&WinJS.UI._processElement(this)}),msSetImmediate(function(){t(n.winControl)})})},processAll:function(n){return new WinJS.Promise(function(t){n?(blueskyUtils.ensureDatasetReady(n),n.dataset&&n.dataset.winControl&&WinJS.UI._processElement(n)):n=document,$("[data-win-control]",n).each(function(){blueskyUtils.ensureDatasetReady(this),WinJS.UI._processElement(this)}),setTimeout(function(){t()},0)})},_processElement:function(n){var t;if(!n.winControl){var u=n.dataset.winOptions?blueskyUtils.convertDeclarativeDataStringToJavascriptObject(n.dataset.winOptions):null,r=n.dataset.winControl.split("."),i=window;for(t=0;t<r.length;t++)i=i[r[t]];n.winControl=new i(n,u),n.winControl.element=n}},enableAnimations:function(){WinJS.UI._animationEnabled=!0},disableAnimations:function(){WinJS.UI._animationEnabled=!1,WinJS.UI.Animation._cancelAllActiveAnimations()},executeAnimation:function(){_warnedExecuteAnimationNYI||(console.warn("Bluesky: WinJS.UI.Animation.executeAnimation is NYI"),_warnedExecuteAnimationNYI=!0)},_warnedExecuteAnimationNYI:!1,_animationEnabled:!0,isAnimationEnabled:function(){return _animationEnabled},TapBehavior:{directSelect:"directSelect",toggleSelect:"invoke",invokeOnly:"invokeOnly",none:"none"},SelectionMode:{none:"none",single:"single",multi:"multi"},SwipeBehavior:{select:"select",none:"none"},IListDataSource:WinJS.Class.define(function(n){this._list=n},{getCount:function(){return WinJS.Promise.wrap(this._list.length)},itemFromKey:function(n){return WinJS.Promise.wrap(this._list.getItemFromKey(n))},itemFromIndex:function(n){return WinJS.Promise.wrap(this._list.getAt(n))},list:{get:function(){return this._list}}}),ISelection:WinJS.Class.define(function(n){this._list=n,this._selectedItems=[]},{add:function(n){var t=this;return new WinJS.Promise(function(i){n.length===undefined?n=[n]:console.error("Passing an array of objects to WinJS.UI.ISelection.add, but ISelectionRange is NYI");var r=t._list.itemDataSource._list;n.forEach(function(n){var i;typeof n=="number"?i=r.getItem(n):n.key!==undefined?i=r.getItemFromKey(n):n.index!==undefined&&(i=r.getItem(n)),t._selectedItems.indexOf(i)==-1&&t._selectedItems.push(i)}),t._list._selectionChanged(),i(n)})},remove:function(n){var t=this;return new WinJS.Promise(function(i){n.length===undefined?n=[n]:console.error("Passing an array of objects to WinJS.UI.ISelection.remove, but ISelectionRange is NYI");var r=t._list.itemDataSource._list;n.forEach(function(n){var i,u;typeof n=="number"?i=r.getItem(n):n.key!==undefined?i=r.getItemFromKey(n):n.index!==undefined&&(i=r.getItem(n)),u=t._selectedItems.indexOf(i),u!=-1&&t._selectedItems.splice(u,1)}),t._list._selectionChanged(),i(n)})},clear:function(){var n=this;return new WinJS.Promise(function(t){n._selectedItems=[],n._list._selectionChanged(),t()})},count:function(){return this._selectedItems.length},getIndices:function(){var n=[];return this._selectedItems.forEach(function(t){n.push(t.index)}),n},isEverything:function(){return this.count==this._list.length},getItems:function(){var n=this;return new WinJS.Promise(function(t){t(n._selectedItems)})},set:function(n){var t=this;return this.clear().then(function(){return t.add(n)})},selectAll:function(){var n=this;this.clear().then(function(){n._list.itemDataSource.getCount().then(function(t){for(var i=0;i<t;i++)n.add(i)})})},getRanges:function(){return new WinJS.Promise(function(n){console.error("WinJS.UI.ISelection.getRanges is NYI"),n([])})}})}),WinJS.Namespace.define("WinJS.UI.Animation",{enterPage:function(n,t){if(WinJS.UI.isAnimationEnabled)return WinJS.UI.Animation.enterContent(n,t)},exitPage:function(n,t){if(WinJS.UI.isAnimationEnabled)return WinJS.UI.Animation.exitContent(n,t)},showPopup:function(n,t){if(WinJS.UI.isAnimationEnabled)return WinJS.UI.Animation._doShowAnimation(n,t,250,"easeOut")},hidePopup:function(n){if(WinJS.UI.isAnimationEnabled)return new WinJS.Promise(function(t){if(!n){t();return}n.length||(n=[n]),$(n).fadeOut("fast").promise().done(function(){t()})})},enterContent:function(n,t){if(WinJS.UI.isAnimationEnabled)return WinJS.UI.Animation._doShowAnimation(n,t,150,"easeOut")},_doShowAnimation:function(n,t,i,r){return new WinJS.Promise(function(u){var v=0,h,o,c;for(t=t||{top:"0px",left:WinJS.UI.Animation._enterExitDistance+"px"},n.length||(n=[n]),t.length||(t=[t]),h=n.length,o=0;o<n.length;o++){if(c=n[o],!c){h--;return}var s=$(c),w=s.css("position"),y=o<t.length?t[o]:t[t.length-1],l=parseInt(y.top),a=parseInt(y.left),p=s.offset();s.offset({top:p.top+l,left:p.left+a}),s.css("opacity","0.5"),s.delay(v).animate({opacity:"1",top:(l>0?"-":"+")+"="+Math.abs(l),left:(a>0?"-":"+")+"="+Math.abs(a)},{duration:i,easing:r||"linear",complete:function(){s.css("position",w),--h==0&&u&&u()}}),v+=WinJS.UI.Animation._staggerDelay}})},exitContent:function(n,t){return new WinJS.Promise(function(i){var h=0,o,f,s;for(t=t||{top:"0px",left:-WinJS.UI.Animation._enterExitDistance+"px"},n.length||(n=[n]),t.length||(t=[t]),o=n.length,f=0;f<n.length;f++){if(s=n[f],!s){o--;return}var e=$(s),c=f<t.length?t[f]:t[t.length-1],l=parseInt(c.top),a=parseInt(c.left),v=e.css("position");e.css("position","relative"),e.delay(h).animate({opacity:"0",left:(a<0?"-":"+")+"="+Math.abs(a),top:(l<0?"-":"+")+"="+Math.abs(l)},100,function(){e.css("position",v),--o==0&&i&&i()}),h+=WinJS.UI.Animation._staggerDelay}})},_cancelAllActiveAnimations:function(){},_staggerDelay:30,_enterExitDistance:20}),WinJS.Namespace.define("WinJS.UI",{BaseControl:WinJS.Class.define(function(n){this.$rootElement=$(n),this.isYielding=!1,n.winControl=this,this.element=n},{render:function(n){if(n){this._doRender(),this.isYielding=!1;return}if(!this.isYielding){this.isYielding=!0;var t=this;return new WinJS.Promise(function(n){setTimeout(function(){t.isYielding&&(t._doRender(),t.isYielding=!1),n()},0)})}},forceLayout:function(){this.render()}})}),WinJS.Class.mix(WinJS.UI.BaseControl,WinJS.UI.DOMEventMixin),WinJS.Namespace.define("WinJS.UI.Fragments",{render:function(n,t){return WinJS.UI.Fragments._render(n,t,!1)},renderCopy:function(n,t){return WinJS.UI.Fragments._render(n,t,!0)},_render:function(n,t,i){return this._cacheStore[n]?this._getDocumentFragmentFromCache(n,t):this._loadAndProcessHrefIntoDocumentFragment(n).then(function(r){return(i&&(WinJS.UI.Fragments._cacheStore[n]=r.cloneNode(!0)),!t)?r:(t.appendChild(r),t)})},_loadAndProcessHrefIntoDocumentFragment:function(n){var t=this;return new WinJS.Promise(function(i){$.get(n,function(n){t._processFragment(n).then(function(n){i(n)})})})},_processFragment:function(n){return new WinJS.Promise(function(t){var s=$("<div><\/div>"),i,e,u,o,f,r;s[0].innerHTML=n,i=document.createDocumentFragment(),s.contents().get().forEach(function(n){i.appendChild(n)}),e=[],u=$("head");for(f in i.childNodes)r=i.childNodes[f],(r.nodeName=="STYLE"||r.nodeName=="LINK"&&r.attributes.getNamedItem("rel").nodeValue=="stylesheet")&&e.push(r);e.forEach(function(n){i.removeChild(n);var t=n.attributes.getNamedItem("href"),r=t&&$("link[href='"+t.nodeValue+"']",u).length>0,f=t&&t.nodeValue.toLowerCase().indexOf("//microsoft")==0;r||f||(u.prepend(n),WinJS.UI.Fragments._testSupportMovedScriptsAndStyles.push(n))}),o=[];for(f in i.childNodes)r=i.childNodes[f],r.nodeName=="SCRIPT"&&o.push(r);o.forEach(function(n){i.removeChild(n);var t=n.attributes.getNamedItem("src"),r=t&&$("script[src='"+t.nodeValue+"']",u).length>0,f=t&&t.nodeValue.toLowerCase().indexOf("//microsoft")==0;r||f||(u.append(n),WinJS.UI.Fragments._testSupportMovedScriptsAndStyles.push(n))}),t(i)})},_getDocumentFragmentFromCache:function(n,t){var i=this._cacheStore[n].cloneNode();return new WinJS.Promise(function(n){t?(t.appendChild(i),n(t)):n(i)})},cache:function(n){var t=this;return this._cacheStore[n]?this._getDocumentFragmentFromCache(n):this._loadAndProcessHrefIntoDocumentFragment(n).then(function(i){return new WinJS.Promise(function(r){t._cacheStore[n]=i,r(i)})})},clearCache:function(n){this._cacheStore[n]&&(this._cacheStore[n]=null)},_testSupportMovedScriptsAndStyles:[],_testSupportRemoveScriptsAndStyles:function(){WinJS.UI.Fragments._testSupportMovedScriptsAndStyles.forEach(function(n){$(n).remove()}),WinJS.UI.Fragments._testSupportMovedScriptsAndStyles=[]},_cacheStore:[]}),WinJS.Namespace.define("WinJS.UI.Pages",{render:function(n,t,i,r){t=t||$("<div><\/div>")[0];var u=this.get(n),f=new u(t,i,null,r);return f.renderPromise},get:function(n){var t=WinJS.UI.Pages.registeredPages[n.toLowerCase()];return t=t||WinJS.UI.Pages.define(n)},_renderingPage:null,_renderingSubpages:[],define:function(n,t){var r=this.registeredPages[n.toLowerCase()],i;return i=r?r:WinJS.Class.define(function(t,i,r,u){var o=WinJS.UI.Pages.registeredPages[n.toLowerCase()],f=this,e;u&&u.then(function(){return WinJS.UI.processAll(t)}).then(function(){if(f==WinJS.UI.Pages._renderingPage&&WinJS.UI.Pages._renderingSubpages.length>0)return WinJS.Promise.join(WinJS.UI.Pages._renderingSubpages)}).then(function(){WinJS.UI.Pages._renderingPage=null,f.ready&&f.ready(t,i),f.updateLayout&&f.updateLayout(t,i,null),f.processed&&f.processed(t,i)}),e=this._loadPage({Uri:n,element:t}).then(function(n){return f._processPage(n)}).then(function(n){return new WinJS.Promise(function(r){f.init&&f.init(t,i),r(n)})}),this.elementReady=e.then(function(){return t}),this.renderPromise=e.then(function(n){return n}),WinJS.UI.Pages._renderingPage?WinJS.UI.Pages._renderingSubpages.push(this.renderPromise):(WinJS.UI.Pages._renderingPage=this,WinJS.UI.Pages._renderingSubpages=[]),u||(this.renderPromise=this.renderPromise.then(function(){return WinJS.UI.processAll(t)}).then(function(){if(f==WinJS.UI.Pages._renderingPage&&WinJS.UI.Pages._renderingSubpages.length>0)return WinJS.Promise.join(WinJS.UI.Pages._renderingSubpages)}).then(function(){WinJS.UI.Pages._renderingPage=null,f.ready&&f.ready(t,i),f.updateLayout&&f.updateLayout(t,i,null),f.processed&&f.processed(t,i)}))},{_loadPage:function(n){var t=this;return new WinJS.Promise(function(i){var r=!1;r||t._getRemotePage(n,i)})},_getRemotePage:function(n,t){$.get(n.Uri,function(i){n.response=i,t(n)})},_processPage:function(n){return new WinJS.Promise(function(t){var f=$("<div><\/div>"),e,i,u,r;f[0].innerHTML=n.response,e=document.createDocumentFragment(),f.contents().get().forEach(function(n){e.appendChild(n)}),i=$(f),i.append(e),$("script",document).each(function(n,t){$("script[src='"+t.attributes.src.value+"']",i).remove()}),$("link[href^='//Microsoft'], link[href^='//microsoft']",i).remove(),$("script[src^='http://Microsoft'], script[src^='http://microsoft'], script[src^='//Microsoft'], script[src^='//microsoft']",i).remove(),u=$(n.element),u.addClass("pagecontrol"),r=$("head",document),$("meta, title, link, style",i).prependTo(r),blueskyUtils.removeDuplicateElements("style","src",r),blueskyUtils.removeDuplicateElements("meta","charset",r),$("title:not(:first)",r).remove(),u.append(i.contents()),$("[id]",u).each(function(n,t){window[t.id]=t}),t(n)})},renderPromise:null}),i=WinJS.Class.mix(i,t),this.registeredPages[n.toLowerCase()]=i,i},registeredPages:[]}),WinJS.Namespace.define("WinJS.UI",{HtmlControl:WinJS.Class.define(function(n,t,i){WinJS.UI.Pages.render(t.uri,n,t).then(i)})}),WinJS.Namespace.define("WinJS.UI",{Flyout:WinJS.Class.derive(WinJS.UI.BaseControl,function(n,t){WinJS.UI.BaseControl.call(this,n,t),$(n).hide(),this._hidden=!0,this._placement=null,this._anchor=null,this._alignment=null},{show:function(n,t,i){var s,e,r,u,f,h,o;if(this.hidden){this._anchor=n,this._placement=t,this._alignment=i,s=document.createEvent("CustomEvent"),s.initCustomEvent("beforeshow",!0,!1,{}),this.element.dispatchEvent(s),e=$(n),r=$(this.element),r.addClass("win-flyout").css({position:"absolute",visibility:"hidden",display:"block"}),u={anchorLeft:e.offset().left,anchorTop:e.offset().top,anchorWidth:e.outerWidth(),anchorHeight:e.outerHeight(),flyoutWidth:r.outerWidth(),flyoutHeight:r.outerHeight(),flyoutLeftMargin:parseInt(r.css("marginLeft")),flyoutTopMargin:parseInt(r.css("marginTop")),flyoutRightMargin:parseInt(r.css("marginRight")),flyoutBottomMargin:parseInt(r.css("marginBottom")),screenHeight:$("html").outerHeight(),screenWidth:$("html").outerWidth()};switch(t||"auto"){case"left":f=this._getLeftPosition(u,!1);break;case"right":f=this._getRightPosition(u,!1);break;case"top":f=this._getTopPosition(u,!1);break;case"bottom":f=this._getBottomPosition(u,!1);break;case"auto":f=this._getTopPosition(u,!0)||this._getBottomPosition(u,!0)||this._getLeftPosition(u,!0)||this._getRightPosition(u,!0)}r.remove().appendTo($("body")).css({left:f.left,top:f.top,"z-index":"10000",visibility:"visible"}),this._hidden=!1,o=this,new WinJS.UI.Animation.showPopup(this.element,[{left:f.animLeft,top:f.animTop}]).then(function(){$("body").bind("click",o._lightDismissHandler.bind(o));var n=document.createEvent("CustomEvent");n.initCustomEvent("aftershow",!0,!1,{}),o.element.dispatchEvent(n)})}},hide:function(){var r,u;this.hidden||($("body").unbind("click",this._lightDismissHandler),r=document.createEvent("CustomEvent"),r.initCustomEvent("beforehide",!0,!1,{}),this.element.dispatchEvent(r),this._hidden=!0,u=this,new WinJS.UI.Animation.hidePopup(this.element).then(function(){$(u.element).css("visibility","hidden");var n=document.createEvent("CustomEvent");n.initCustomEvent("afterhide",!0,!1,{}),u.element.dispatchEvent(n)}),this._placement=null,this._anchor=null,this._alignment=null)},_lightDismissHandler:function(n){var t=this.$rootElement.offset(),i=this.$rootElement.outerWidth(),r=this.$rootElement.outerHeight();n.clientX>=t.left&&n.clientX<=t.left+i&&n.clientY>=t.top&&n.clientY<=t.top+r||this.hide()},_getLeftPosition:function(n,t){var r=n.anchorLeft-n.flyoutWidth-n.flyoutLeftMargin-n.flyoutRightMargin,i=n.anchorTop-n.flyoutTopMargin+(n.anchorHeight-n.flyoutHeight)/2;return t&&r<0?null:(i=Math.max(0,i),i=Math.min(n.screenHeight-n.flyoutHeight-n.flyoutBottomMargin-n.flyoutTopMargin,i),{left:r,top:i,animLeft:"40px",animTop:"0px"})},_getRightPosition:function(n,t){var i=n.anchorTop-n.flyoutTopMargin+(n.anchorHeight-n.flyoutHeight)/2,r=n.anchorLeft+n.anchorWidth;return t&&r>n.screenWidth-(n.flyoutWidth+n.flyoutLeftmargin+n.flyoutRightMargin)?null:(i=Math.max(0,i),i=Math.min(n.screenHeight-n.flyoutHeight-n.flyoutBottomMargin-n.flyoutTopMargin,i),{left:r,top:i,animLeft:"-40px",animTop:"0px"})},_getTopPosition:function(n,t){var i=n.anchorLeft-n.flyoutLeftMargin+(n.anchorWidth-n.flyoutWidth)/2,r=n.anchorTop-n.flyoutHeight-n.flyoutBottomMargin-n.flyoutTopMargin;return t&&r<0?null:(i=Math.max(0,i),i=Math.min(n.screenWidth-n.flyoutWidth-n.flyoutLeftMargin-n.flyoutLeftMargin,i),{left:i,top:r,animLeft:"0px",animTop:"40px"})},_getBottomPosition:function(n,t){var i=n.anchorLeft-n.flyoutLeftMargin+(n.anchorWidth-n.flyoutWidth)/2,r=n.anchorTop+n.anchorHeight;return t&&r>n.screenHeight-(n.flyoutHeight+n.flyoutBottomMargin+n.flyoutTopMargin)?null:(i=Math.max(0,i),i=Math.min(n.screenWidth-n.flyoutWidth-n.flyoutLeftMargin-n.flyoutLeftMargin,i),{left:i,top:r,animLeft:"0px",animTop:"-10px"})},onafterhide:{get:function(){return this._onafterhide},set:function(n){this._onafterhide&&this.removeEventListener("afterhide",this._onafterhide),this._onafterhide=n,this.addEventListener("afterhide",n)}},onaftershow:{get:function(){return this._onaftershow},set:function(n){this._onaftershow&&this.removeEventListener("aftershow",this._onaftershow),this._onaftershow=n,this.addEventListener("aftershow",n)}},onbeforehide:{get:function(){return this._onbeforehide},set:function(n){this._onbeforehide&&this.removeEventListener("beforehide",this._onbeforehide),this._onbeforehide=n,this.addEventListener("beforehide",n)}},onbeforeshow:{get:function(){return this._onbeforeshow},set:function(n){this._onbeforeshow&&this.removeEventListener("beforeshow",this._onbeforeshow),this._onbeforeshow=n,this.addEventListener("beforeshow",n)}},_hidden:!0,hidden:{get:function(){return this._hidden}},_alignment:null,alignment:{get:function(){return this._alignment}},_placement:!0,placement:{get:function(){return this._placement}},_anchor:!0,anchor:{get:function(){return this._anchor}}})}),WinJS.Namespace.define("WinJS.UI",{Rating:WinJS.Class.derive(WinJS.UI.BaseControl,function(n,t){n=n||$("<div><\/div>")[0],WinJS.UI.BaseControl.call(this,n,t),this._mouseDown=!1,this._overClickedStar=null,this.enableClear=!0,this.averageRating=0,this.disabled=!1,this.maxRating=5,WinJS.UI.setOptions(this,t),this.render(!0)},{_doRender:function(){var n,i,r,t;for(this.$rootElement.empty().addClass("win-rating").attr("role","slider"),n=0;n<this.maxRating;n++)i=this.userRating?n<this.userRating?"win-full win-user":"win-empty":n<this.averageRating?"win-full":"win-empty",r=this.tooltipStrings?this.tooltipStrings[n]:n+1,t=$('<div class="win-star '+i+'" style="float:left" title='+r+"><\/div>").data("index",n),this.$rootElement.append(t),t.mousemove(this.handleMouseMove.bind(this)),t.click(this.handleMouseClick.bind(this));this.$rootElement.append("<div style='clear:both'><\/div>"),this.$rootElement.mouseleave(this.handleMouseLeave.bind(this)).mousedown(function(){this.winControl._mouseDown=!0}).mouseup(function(){this.winControl._mouseDown=!1})},handleMouseLeave:function(n){if(!this.disabled){if(this._overClickedStar=null,this.enableClear&&this._mouseDown){var t=n.clientX-$(n.currentTarget).offset().left;t<=0&&(this.userRating=null)}this._notifyCancel(),this.render()}},handleMouseClick:function(n){var t,i;this.disabled||(t={tentativeRating:this.userRating,preventDefault:!1},this._notifyPreviewChange(t),t.preventDefault)||(i=$(n.currentTarget).data("index"),this._overClickedStar=i,this.userRating=i+1,t.tentativeRating=this.userRating,t.userRating=this.userRating,this._notifyChange(t))},handleMouseMove:function(n){if(!this.disabled){var t=$(n.currentTarget);if(this._overClickedStar){if(this._overClickedStar==t.data("index"))return;this._overClickedStar=null}t.siblings().removeClass("win-user win-full").addClass("win-empty"),t.removeClass("win-empty win-user win-full").addClass("win-full win-tentative"),t.prevAll().removeClass("win-empty win-user win-full").addClass("win-full win-tentative")}},_notifyChange:function(n){var t=document.createEvent("CustomEvent");t.initCustomEvent("change",!0,!1,n),this.element.dispatchEvent(t)},_notifyPreviewChange:function(n){var t=document.createEvent("CustomEvent");t.initCustomEvent("previewchange",!0,!1,n),this.element.dispatchEvent(t)},_notifyCancel:function(n){var t=document.createEvent("CustomEvent");t.initCustomEvent("cancel",!0,!1,n),this.element.dispatchEvent(t)},_userRating:null,userRating:{get:function(){return this._userRating},set:function(n){this._userRating=n,this.render()}},_averageRating:null,averageRating:{get:function(){return this._averageRating},set:function(n){this._averageRating=n,this.render()}},_maxRating:null,maxRating:{get:function(){return this._maxRating},set:function(n){this._maxRating=n,this.render()}},_tooltipStrings:null,tooltipStrings:{get:function(){return this._tooltipStrings},set:function(n){this._tooltipStrings=n,this.render()}}})}),WinJS.Namespace.define("WinJS.UI",{FlipView:WinJS.Class.derive(WinJS.UI.BaseControl,function(n,t){WinJS.UI.BaseControl.call(this,n,t),t&&(t.orientation&&(this.orientation=t.orientation.toLowerCase()),t.itemSpacing&&(this.itemSpacing=t.itemSpacing),t.itemDataSource&&(this.itemDataSource=eval(t.itemDataSource)),t.itemTemplate&&(this.itemTemplate=document.getElementById(t.itemTemplate)),t.currentPage&&(this.currentPage=t.currentPage));var i=this;msSetImmediate(function(){i.currentPage==-1&&(i.currentPage=0)})},{_doRender:function(){var e,i,o,r,t,u,f;if(this.itemDataSource||this.itemTemplate){this.$rootElement.empty().addClass("win-flipview").attr("role","listbox").css("overflow","hidden"),this._items=[];var h=this.$rootElement.outerWidth(),c=this.$rootElement.outerHeight(),n=$("<div style='width:100%;height:100%;position:relative;z-index: 0;'><\/div>");for(n.append($('<div tabindex="0" aria-hidden="true"><\/div>')),this.orientation=="horizontal"?(n.append($('<button tabindex="-1" class="win-navbutton win-navleft" aria-hidden="true" style="display:none; z-index: 1000; font-weight:800" type="button">&lt;<\/button>')),n.append($('<button tabindex="-1" class="win-navbutton win-navright" aria-hidden="false" style=" display:none;z-index: 1000; font-weight:800" type="button">&gt;<\/button>'))):(n.append($('<button tabindex="-1" class="win-navbutton win-navtop" aria-hidden="true" style="display:none; z-index: 1000; font-weight:800" type="button">^<\/button>')),n.append($('<button tabindex="-1" class="win-navbutton win-navbottom" aria-hidden="false" style=" display:none;z-index: 1000; font-weight:800" type="button">v<\/button>'))),n.append($('<div tabindex="0"><\/div>')),e=$('<div class="win-surface" role="group" style="width: 100%; height: 100%; position: relative;">'),this.$itemsContainer=$("<div style='width:100%;height:100%;position:relative;'><\/div>"),i=0;i<this.itemDataSource._list.length;i++){if(o=this.itemDataSource._list.getItem(i),r=$("<div style='width: "+h+"px; height: "+c+"px; position: absolute;'><\/div>").hide(),typeof this.itemTemplate!="function")t=$("<div class='win-item'><\/div>"),u=$(this.itemTemplate).clone().addClass("win-template").removeAttr("data-win-control").show()[0],blueskyUtils.setDOMElementUniqueId(u),WinJS.Binding.processAll(u,o.data),t.append(u);else{t=document.createElement("div"),t.className="win-template";var l=this._curItemIndex,s=new WinJS.Promise(function(n){n({data:o.data,index:l})}),f=this;s.then(function(){return f.itemTemplate(s)}).then(function(n){n.element&&(n=n.element),t.appendChild(n)})}r.append(t),this.$itemsContainer.append(r),this._items[i]=r}e.append(this.$itemsContainer),n.append(e),this.$rootElement.append(n),f=this,$(".win-navleft, .win-navtop",this.$rootElement).click(function(){f.previous()}),$(".win-navright, .win-navbottom",this.$rootElement).click(function(){f.next()}),typeof this.currentPage=="undefined"&&(this.currentPage=0),this._makePageVisible(this._currentPage)}},_orientation:"horizontal",orientation:{get:function(){return this._orientation},set:function(n){this._orientation=n,this.render(!0)}},_notifyPageCompleted:function(n,t){var i=document.createEvent("CustomEvent");i.initCustomEvent("pagecompleted",!0,!1,t),n.dispatchEvent(i)},_notifyDataSourceCountChanged:function(n,t){var i=document.createEvent("CustomEvent");i.initCustomEvent("datasourcecountchanged",!0,!1,t),n.dispatchEvent(i)},_notifyPageSelected:function(n,t){var i=document.createEvent("CustomEvent");i.initCustomEvent("pageselected",!0,!1,t),n.dispatchEvent(i)},_notifyPageVisibilityChanged:function(n,t){var i=document.createEvent("CustomEvent");i.initCustomEvent("pagevisibilitychanged",!0,!1,t),n.dispatchEvent(i)},ondatasourcecountchanged:{get:function(){return this._ondatasourcecountchanged},set:function(n){this._ondatasourcecountchanged&&this.removeEventListener("datasourcecountchanged",this._ondatasourcecountchanged),this._ondatasourcecountchanged=n,this.addEventListener("datasourcecountchanged",n)}},onpagecompleted:{get:function(){return this._onpagecompleted},set:function(n){this._onpagecompleted&&this.removeEventListener("pagecompleted",this._onpagecompleted),this._onpagecompleted=n,this.addEventListener("pagecompleted",n)}},onpageselected:{get:function(){return this._onpageselected},set:function(n){this._onpageselected&&this.removeEventListener("pageselected",this._onpageselected),this._onpageselected=n,this.addEventListener("pageselected",n)}},onpagevisibilitychanged:{get:function(){return this._onpagevisibilitychanged},set:function(n){this._onpagevisibilitychanged&&this.removeEventListener("pagevisibilitychanged",this._onpagevisibilitychanged),this._onpagevisibilitychanged=n,this.addEventListener("pagevisibilitychanged",n)}},count:function(){if(!this._itemDataSource)return 0;var n=this;return new WinJS.Promise(function(t){t(n._itemDataSource._list.length)})},next:function(){var n,u,t,r,i;return this.currentPage==this._items.length-1?!1:(n=this.currentPage+1,this._makePageVisible(n),$(this._items[this._currentPage]).fadeOut("fast"),u=$(".win-template",this._items[this._currentPage])[0],t=$(".win-template",this._items[n])[0],this._notifyPageVisibilityChanged(u,{source:this.element,visible:!0}),this._currentPage=n,this._notifyPageVisibilityChanged(t,{source:this.element,visible:!1}),this._notifyPageSelected(t,{source:this.element}),i=this,r=this.orientation=="horizontal"?{top:"0px",left:"40px"}:{top:"40px",left:"0px"},i=this,WinJS.UI.Animation.enterContent([this._items[this._currentPage]],[r]).then(function(){i._notifyPageCompleted(t,{source:i.element})}))},previous:function(){var n,u,t,r,i;return this.currentPage==0?!1:(n=this.currentPage-1,this._makePageVisible(n),$(this._items[this._currentPage]).fadeOut("fast"),u=$(".win-template",this._items[this._currentPage])[0],t=$(".win-template",this._items[n])[0],this._notifyPageVisibilityChanged(u,{source:this.element,visible:!0}),this._currentPage=n,this._notifyPageVisibilityChanged(t,{source:this.element,visible:!1}),this._notifyPageSelected(t,{source:this.element}),i=this,r=this.orientation=="horizontal"?{top:"0px",left:"-40px"}:{top:"-40px",left:"0px"},i=this,WinJS.UI.Animation.enterContent([this._items[this._currentPage]],[r]).then(function(){i._notifyPageCompleted(t,{source:i.element})}))},_currentPage:-1,currentPage:{get:function(){return this._currentPage},set:function(n){var t,r,i;if(n=Math.max(n,0),this._currentPage!=n)return!this._itemDataSource||n>=this._itemDataSource.getCount()?void 0:(t=this,this._makePageVisible(n),r=$(".win-template",this._items[this._currentPage])[0],i=$(".win-template",this._items[n])[0],r&&($(this._items[this._currentPage]).fadeOut("fast"),this._notifyPageVisibilityChanged(r,{source:this.element,visible:!0})),!i)?void 0:(this._currentPage=n,this._notifyPageVisibilityChanged(i,{source:this.element,visible:!1}),this._notifyPageSelected(i,{source:this.element}),new WinJS.Promise(function(n){$(t._items[t._currentPage]).fadeIn("fast",function(){t._notifyPageCompleted(i,{source:t.element}),n()})}))}},_makePageVisible:function(n){n!=-1&&(this._items.length>n&&this._items[n].remove().appendTo(this.$itemsContainer).show(),n>0?$(".win-navleft, .win-navtop",this.$rootElement).show():$(".win-navleft, .win-navtop",this.$rootElement).hide(),n<this._items.length-1?$(".win-navright, .win-navbottom",this.$rootElement).show():$(".win-navright, .win-navbottom",this.$rootElement).hide())},_itemDataSource:null,itemDataSource:{get:function(){return this._itemDataSource},set:function(n){var t=this,u=function(){t.render(!0),t.currentPage=Math.min(t._currentPage,t._itemDataSource._list.length-1)},i=function(){t.render(!0),t.currentPage=Math.min(t._currentPage,t._itemDataSource._list.length-1),t._notifyDataSourceCountChanged(t.element)},r;this._itemDataSource&&this._itemDataSource._list&&(this._itemDataSource._list.removeEventListener("itemremoved",i),this._itemDataSource._list.removeEventListener("iteminserted",i),this._itemDataSource._list.removeEventListener("itemchanged",u)),r=this._itemDataSource,this._itemDataSource=n,this._itemDataSource._list.addEventListener("itemremoved",i),this._itemDataSource._list.addEventListener("iteminserted",i),this._itemDataSource._list.addEventListener("itemchanged",u),this.render(),this.currentPage=Math.max(0,Math.min(this._currentPage,this._itemDataSource._list.length-1)),r&&n._list.length!=r._list.length&&this._notifyDataSourceCountChanged()}},_itemTemplate:null,itemTemplate:{get:function(){return this._itemTemplate},set:function(n){this._itemTemplate=n,this.render()}},_items:[],$itemsContainer:null})}),WinJS.Namespace.define("WinJS.UI",{ListLayout:WinJS.Class.define(function(n){n&&n.groupInfo&&(this.groupInfo=eval(n.groupInfo))},{horizontal:{get:function(){return!1}}})}),WinJS.Namespace.define("WinJS.UI",{GridLayout:WinJS.Class.define(function(n){n&&(n.groupInfo&&(this.groupInfo=eval(n.groupInfo)),this.maxRows=n.maxRows,this.groupHeaderPosition=n.groupHeaderPosition)},{horizontal:{get:function(){return!0}}})}),WinJS.Namespace.define("WinJS.UI",{SemanticZoom:WinJS.Class.derive(WinJS.UI.BaseControl,function(n,t){WinJS.UI.BaseControl.call(this,n,t),this.$rootElement.addClass("win-semanticzoom").css("position","relative"),this.$rootElement.attr("role","ms-semanticzoomcontainer"),this._$zoomedInElement=$(">div::nth-child(1)",this.$rootElement),this._$zoomedOutElement=$(">div::nth-child(2)",this.$rootElement),this._$zoomContainer=$("<div style='position: absolute; left: 0px; top: 0px; overflow: hidden'><\/div>").appendTo(this.$rootElement),this._$zoomedInContainer=$("<div style='position:absolute;top:0px;left:0px;overflow: hidden'><\/div>").appendTo(this._$zoomContainer),this._$zoomedOutContainer=$("<div style='position:absolute;top:0px;left:0px;overflow: hidden'><\/div>").appendTo(this._$zoomContainer),this._$zoomedInSubContainer=$("<div style='position:absolute;top:0px;left:0px;overflow: hidden'><\/div>").appendTo(this._$zoomedInContainer),this._$zoomedOutSubContainer=$("<div style='position:absolute;top:0px;left:0px;overflow: hidden'><\/div>").appendTo(this._$zoomedOutContainer),this._$zoomedInElement.appendTo(this._$zoomedInSubContainer),this._$zoomedOutElement.appendTo(this._$zoomedOutSubContainer);var i={width:this.$rootElement.innerWidth(),height:this.$rootElement.innerHeight()};this._$zoomContainer.css(i),this._$zoomedInContainer.css(i),this._$zoomedOutContainer.css(i),this._$zoomedInSubContainer.css(i),this._$zoomedOutSubContainer.css(i),this._$zoomedInElement.css(i),this._$zoomedOutElement.css(i),this._addZoomButton(),WinJS.UI.processAll(this.element),this._showElement(this._$zoomedInContainer),this._hideElement(this._$zoomedOutContainer),this._zoomedInListView=this._$zoomedInElement[0].winControl,this._zoomedOutListView=this._$zoomedOutElement[0].winControl,this._zoomedOutListView.oniteminvoked=this._zoomedOutListItemClicked.bind(this),this._enableButton=!0,this._locked=!1,this._zoomedOut=!1,this._zoomFactor=.65},{onzoomchanged:{get:function(){return this._onzoomchanged},set:function(n){this._onzoomchanged&&this.removeEventListener("zoomchanged",this._onzoomchanged),this._onzoomchanged=n,this.addEventListener("zoomchanged",n)}},_enableButton:!0,enableButton:{get:function(){return this._enableButton},set:function(n){this._enableButton=n,this._enableButton?this._addZoomButton():this._removeZoomButton()}},_locked:!1,locked:{get:function(){return this._locked},set:function(n){this._locked=n}},_zoomedOut:!1,zoomedOut:{get:function(){return this._zoomedOut},set:function(n){var t,i;this._locked||this._zoomedOut!=n&&(this._zoomedOut=n,t=[],n?(t.push(this._hideElement(this._$zoomedInContainer)),t.push(this._showElement(this._$zoomedOutContainer)),this._$zoomButton.hide().css({visibility:"hidden"})):(t.push(this._showElement(this._$zoomedInContainer)),t.push(this._hideElement(this._$zoomedOutContainer)),this.enableButton&&this._$zoomButton.show().css({visibility:"visible"})),i=this,WinJS.Promise.join(t).then(function(){var n=document.createEvent("CustomEvent");n.initCustomEvent("zoomchanged",!0,!1,{}),i.element.dispatchEvent(n)}))}},_zoomFactor:.65,zoomFactor:{get:function(){return this._zoomFactor}},_showElement:function(n){return new WinJS.Promise(function(t){n.fadeIn("fast",function(){n.css({visibility:"visible"}),t()})})},_hideElement:function(n){return new WinJS.Promise(function(t){n.fadeOut("fast",function(){n.css({visibility:"hidden"}),t()})})},_addZoomButton:function(){this._$zoomButton=$("<button class='win-semanticzoom-button win-semanticzoom-button-location ltr'><\/button>"),this.$rootElement.append(this._$zoomButton);var n=this;this._$zoomButton.click(function(){n.zoomedOut=!0})},_removeZoomButton:function(){this._$zoomButton.remove()},_zoomedOutListItemClicked:function(n){this.zoomedOut=!1;var t=this;n.detail.itemPromise.then(function(n){for(var r=t._zoomedInListView._itemDataSource._list,u,i=0;i<r.length;i++)if(u=r.getItem(i),u.groupKey==n.key){t._zoomedInListView.indexOfFirstVisible=i;break}})}})}),WinJS.Namespace.define("WinJS.UI",{ListView:WinJS.Class.derive(WinJS.UI.BaseControl,function(n,t){WinJS.UI.BaseControl.call(this,n,t),this.selection=new WinJS.UI.ISelection(this),this.tapBehavior=WinJS.UI.TapBehavior.invokeOnly,this.swipeBehavior=WinJS.UI.SwipeBehavior.select,this.selectionMode=WinJS.UI.SelectionMode.multi,this.layout=t&&t.layout&&t.layout.type=="WinJS.UI.ListLayout"?new WinJS.UI.ListLayout(t&&t.layout):new WinJS.UI.GridLayout(t&&t.layout),this.items=[],this._lastSelectedItemIndex=0,t&&(t.selectionMode&&(this.selectionMode=t.selectionMode),t.tapBehavior&&(this.tapBehavior=t.tapBehavior),t.swipeBehavior&&(this.swipeBehavior=t.swipeBehavior),t.itemDataSource&&(this.itemDataSource=eval(t.itemDataSource)),t.itemTemplate&&(this.itemTemplate=document.getElementById(t.itemTemplate)||eval(t.itemTemplate)),t.groupDataSource&&(this.groupDataSource=eval(t.groupDataSource)),t.groupHeaderTemplate&&(this.groupHeaderTemplate=document.getElementById(t.groupHeaderTemplate)||eval(t.groupHeaderTemplate)))},{_doRender:function(){var f,n,r,t;if(this.itemDataSource&&this.itemTemplate){f=$("body"),this.$rootElement.empty();var e=this.layout.horizontal?"win-horizontal":"win-vertical",u=$("<div class='win-viewport "+e+"' role='group'><\/div>"),i=$("<div class='win-surface'><\/div>");for(this.$viewport=u,this.$scrollSurface=i,i.css("height",this.$rootElement.innerHeight()),i.css("width",this.$rootElement.innerWidth()),u.append(i),this.$rootElement.append(u),this.$rootElement.css("position","relative").attr("role","listbox").addClass("win-listview"),this._groupDataSource&&this.$rootElement.addClass("win-groups"),this.items=[],t=0;t<this.itemDataSource._list.length;t++)this.items.push(this.itemDataSource._list.getItem(t));if(n=this,r=[],typeof this.itemTemplate!="function")this.items.forEach(function(t){n._renderItemTemplate(t)}),r.push(WinJS.Promise.as());else for(t=0;t<this.items.length;t++)r.push(this._getItemFunctionRenderPromise(this.items[t],t));WinJS.Promise.join(r).then(function(){for(var e=0,o=0,k=n.$rootElement.innerHeight(),r=0,p=n.layout.groupInfo&&n.layout.groupInfo(),w=null,f,u,c=-1,b=n._getItemMargins(),d=n.layout&&n.layout.groupHeaderPosition=="left",g=n.$rootElement.innerWidth(),y,a,t,s=0;s<n.items.length;s++){var l=n.items[s],v=$(l.element),h=$("<div class='win-container'><\/div>");h.append(v),i.append(h),y=n.layout.horizontal?v.innerWidth():g,a=v.innerHeight(),p&&p.enableCellSpanning,n._groupDataSource&&l.groupKey!=w?(w=l.groupKey,t=$(n.groupHeaderTemplate).clone().addClass("win-groupheader").show(),blueskyUtils.setDOMElementUniqueId(t[0]),WinJS.Binding.processAll(t[0],n._groupDataSource._list.getItemFromKey(l.groupKey).data),t.removeAttr("data-win-control"),i.append(t),d?u===undefined?(u=0,f=parseInt(t.css("marginLeft"))+t.outerWidth()+parseInt(t.css("marginRight")),r=f):r+=f:u===undefined?(u=t.outerHeight(),f=parseInt(t.css("marginLeft")),r=f):r+=f,o=u,e=r,c=0,t.css({position:"absolute",top:"0px",left:e-f+"px"})):(u===undefined&&(u=0),n.layout.horizontal&&(o+a>=k||n.layout.maxRows&&c==n.layout.maxRows-1?(o=u,e=r,c=0):c++)),h.css({top:o,left:e,width:y,height:a}),r=Math.max(r,e+y+b.horizontal),o+=a+b.vertical,$(".win-item",h).data("itemIndex",s),$(".win-item",h).click(function(){var t=$(this).data("itemIndex"),r,u,i;if(n.tapBehavior!="none"&&(n.tapBehavior=="invokeOnly"&&blueskyUtils.shiftPressed||blueskyUtils.controlPressed||(r=new WinJS.Promise(function(i){i(n.items[t])}),n._notifyItemInvoked(this.parentNode,{itemIndex:t,itemPromise:r}))),(n.tapBehavior=="directSelect"||n.tapBehavior=="toggleSelect"||blueskyUtils.shiftPressed||blueskyUtils.controlPressed)&&n.selectionMode!="none"){if(u=$(this.parentNode),n.selectionMode=="multi"&&blueskyUtils.shiftPressed){var e=Math.min(t,n._lastSelectedItemIndex),o=Math.max(t,n._lastSelectedItemIndex),f=[];for(i=e;i<=o;i++)f.push(i);n.selection.set(f)}else n.tapBehavior=="directSelect"?n.selectionMode=="multi"&&blueskyUtils.controlPressed?n.selection.add(t):n.selection.set(t):u.hasClass("win-selected")?n.selection.remove(t):n.selectionMode=="multi"&&blueskyUtils.controlPressed?n.selection.add(t):n.selection.set(t);n._lastSelectedItemIndex=t,n._notifySelectionChanged(n.element)}})}i.css("width",r).show(),WinJS.UI.Animation.enterContent([i[0]])})}},_getItemMargins:function(){var n=this.layout.horizontal?"win-horizontal":"win-vertical",t=$("<div class='win-listview'><div class='"+n+"'><div id='_cont1' class='win-container'><\/div><\/div><\/div>").hide().appendTo($("body")),i={vertical:parseInt($("#_cont1").css("marginTop"))+parseInt($("#_cont1").css("marginBottom")),horizontal:parseInt($("#_cont1").css("marginLeft"))+parseInt($("#_cont1").css("marginRight"))};return t.remove(),i},_renderItemTemplate:function(n){n.element=$(this.itemTemplate).clone().addClass("win-item").removeAttr("data-win-control").show()[0],blueskyUtils.setDOMElementUniqueId(n.element),WinJS.Binding.processAll(n.element,n.data)},_getItemFunctionRenderPromise:function(n,t){var i=this;return new WinJS.Promise(function(r){var u=new WinJS.Promise(function(i){i({data:n.data,index:t})});return u.then(function(){return i.itemTemplate(u)}).then(function(t){t.element&&(t=t.element),n.element=t,$(n.element).attr("id")||blueskyUtils.setDOMElementUniqueId(n.element);var i=$(n.element);n.elementWidth=i.outerWidth(),n.elementHeight=i.outerHeight(),i.addClass("win-item"),r()})})},_itemDataSource:null,itemDataSource:{get:function(){return this._itemDataSource},set:function(n){var i=this,t=function(){i.render(!0)};this._itemDataSource&&this._itemDataSource._list&&(this._itemDataSource._list.removeEventListener("itemremoved",t),this._itemDataSource._list.removeEventListener("iteminserted",t),this._itemDataSource._list.removeEventListener("itemchanged",t)),this._itemDataSource=n,this._itemDataSource._list.addEventListener("itemremoved",t),this._itemDataSource._list.addEventListener("iteminserted",t),this._itemDataSource._list.addEventListener("itemchanged",t),this.render()}},_groupDataSource:null,groupDataSource:{get:function(){return this._groupDataSource},set:function(n){var i=this,t=function(){i.render(!0)},r;this._groupDataSource&&this._groupDataSource._list&&(this._groupDataSource._list.removeEventListener("itemremoved",t),this._groupDataSource._list.removeEventListener("iteminserted",t),this._groupDataSource._list.removeEventListener("itemchanged",t)),r=this._groupDataSource,this._groupDataSource=n,this._groupDataSource&&this._groupDataSource._list&&(this._groupDataSource._list.addEventListener("itemremoved",t),this._groupDataSource._list.addEventListener("iteminserted",t),this._groupDataSource._list.addEventListener("itemchanged",t)),this.render()}},_itemTemplate:null,itemTemplate:{get:function(){return this._itemTemplate},set:function(n){this._itemTemplate=n,this.render()}},_layout:null,layout:{get:function(){return this._layout},set:function(n){this._layout=n instanceof WinJS.UI.ListLayout||n instanceof WinJS.UI.GridLayout?n:new WinJS.UI.GridLayout(n),this.render()}},_windowResized:function(){this.render()},_notifySelectionChanged:function(n,t){var i=document.createEvent("CustomEvent");i.initCustomEvent("selectionchanged",!0,!1,t),n.dispatchEvent(i)},_notifyItemInvoked:function(n,t){var i=document.createEvent("CustomEvent");i.initCustomEvent("iteminvoked",!0,!1,t),n.dispatchEvent(i)},oniteminvoked:{get:function(){return this._oniteminvoked},set:function(n){this._oniteminvoked&&this.removeEventListener("iteminvoked",this._oniteminvoked),this._oniteminvoked=n,this.addEventListener("iteminvoked",n)}},onselectionchanged:{get:function(){return this._onselectionchanged},set:function(n){this._onselectionchanged&&this.removeEventListener("selectionchanged",this._onselectionchanged),this._onselectionchanged=n,this.addEventListener("selectionchanged",n)}},_selectionChanged:function(){var n=this;this.items.forEach(function(t){var i=$(t.element.parentNode),r=i.hasClass("win-selected"),u=n.selection._selectedItems.indexOf(t)>=0;r&&!u?(i.removeClass("win-selected"),$(".win-selectionbackground, .win-selectioncheckmarkbackground, .win-selectioncheckmark",i).remove()):!r&&u&&(i.addClass("win-selected"),$(t.element).before($("<div class='win-selectionbackground'><\/div>")).after($("<div class='win-selectionbordercontainer'><div class='win-selectionborder win-selectionbordertop'><\/div><div class='win-selectionborder win-selectionborderright'><\/div><div class='win-selectionborder win-selectionborderbottom'><\/div><div class='win-selectionborder win-selectionborderleft'><\/div><\/div><div class='win-selectioncheckmarkbackground'><\/div><div class='win-selectioncheckmark'>X&nbsp;<\/div>")))})},scrollPosition:{get:function(){return this.layout.horizontal?this.$viewport.scrollLeft():this.$viewport.scrollTop()},set:function(n){this.layout.horizontal?this.$viewport.scrollLeft(n):this.$viewport.scrollTop(n)}},indexOfFirstVisible:{get:function(){return console.warn("ListView.indexOfFirstVisible getter is NYI; returning 0"),0},set:function(n){var t=this.items[n].element.parentNode,i=parseInt(this.$scrollSurface.css("marginLeft")),r=parseInt($(t).css("marginLeft"));this.scrollPosition=this.layout.horizontal?t.offsetLeft+i-r:t.offsetTop}}})}),WinJS.Namespace.define("Windows.UI.Popups",{UICommand:WinJS.Class.define(function(n,t,i){this._label=n,this._invoked=t,this._id=i},{_id:0,id:{get:function(){return this._id},set:function(n){this._id=n}},_invoked:0,invoked:{get:function(){return this._invoked},set:function(n){this._invoked=n}},_label:0,label:{get:function(){return this._label},set:function(n){this._label=n}}})}),WinJS.Namespace.define("Windows.UI.Popups",{MessageDialog:WinJS.Class.define(function(n,t){this._content=n,this._title=t,this._commands=new Windows.Foundation.Collections.IVector},{showAsync:function(){var n=this;return new WinJS.Promise(function(t){var f=blueskyUtils.getHighestZIndex(),e=$("<div style='width:100%;height:100%;background-color:#000;opacity:.5;z-index:"+(f+1)+"'><\/div>"),l,u,s,i;e.fadeIn("fast").appendTo("body");var o=n.title?200:160,c=($("html").outerHeight()-o)/2,r=$("<div><\/div>").css({width:"100%","background-color":"#fff","z-index":f+2,left:0,position:"absolute",top:c,height:o,right:0}),l=$("<div>"+n.content+"<\/div>").css({color:"#000","font-size":"16pt",position:"absolute",top:n.title?80:20,left:"400px"}).appendTo(r);for(n.title&&(l=$("<div>"+n.title+"<\/div>").css({color:"#000","font-size":"30pt",position:"absolute",top:20,left:"400px"}).appendTo(r)),n.commands.size()==0&&(u=new Windows.UI.Popups.UICommand("Close"),n.commands.append(u)),s=1300-n.commands.size()*200,i=0;i<n.commands.size();i++){var h=n.commands.getAt(i),a=i==n.defaultCommandIndex?"rgba(53,206,251,1)":"#ccc",v=i==n.defaultCommandIndex?"solid 3px #000":"solid 3px #ccc",y=s+i*200,p=$("<div>"+h.label+"<\/div>").css({color:"#000","background-color":a,border:v,width:"150px",cursor:"pointer",padding:"8px 6px","font-size":"12pt","font-weight":"600",position:"absolute","text-align":"center",top:n.title?130:80,left:y}).appendTo(r);p.bind("click",{command:h},function(t){t.data.command.invoked&&t.data.command.invoked(t.data.command),n._close(t.data.command)})}u&&n.commands.clear(),r.fadeIn("fast").appendTo("body"),n._$message=r,n._$overlay=e,n._onClosedPromise=t})},_close:function(n){var t=this;this._$overlay.fadeOut("fast",function(){t._$overlay.remove()}),this._$message.fadeOut("fast",function(){t._$message.remove(),t._onClosedPromise(n)})},_defaultCommandIndex:0,defaultCommandIndex:{get:function(){return this._defaultCommandIndex},set:function(n){this._defaultCommandIndex=n}},_cancelCommandIndex:-1,cancelCommandIndex:{get:function(){return this._cancelCommandIndex},set:function(n){this._cancelCommandIndex=n}},_commands:null,commands:{get:function(){return this._commands},set:function(n){this._commands=n}},_content:"",content:{get:function(){return this._content},set:function(n){this._content=n}},_options:{},options:{get:function(){return this._options},set:function(n){this._options=n}},_title:"",title:{get:function(){return this._title},set:function(n){this._title=n}}})}),WinJS.Namespace.define("Windows.UI.WebUI",{ActivatedOperation:WinJS.Class.define(null,{getDeferral:function(){var n=new Windows.UI.WebUI.ActivatedDeferral;return Windows.UI.WebUI._activationDeferrals.push(n._promise),n}}),ActivatedDeferral:WinJS.Class.define(function(){var n=this;this._promise=new WinJS.Promise(function(t){n.complete=t})},{}),_activationDeferrals:[]}),WinJS.Namespace.define("WinJS.Utilities",{ready:function(n){return new WinJS.Promise(function(t){$(document).ready(function(){n(),t()})})},createEventProperties:function(){for(var r={},i,t=0;t<arguments.length;t++)i=arguments[t],r["on"+i]=this._createProperty(i);return r},_createProperty:function(n){var i="on"+n,t="_on"+n;return{get:function(){return this[t]},set:function(i){this[t]&&this.removeEventListener(n,i),this[t]=i,this.addEventListener(n,i)}}},eventMixin:{addEventListener:function(n,t){this._eventListeners||(this._eventListeners=[]),this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push(t)},removeEventListener:function(n,t){for(var r=this._eventListeners[n],i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);return}},dispatchEvent:function(n,t){var i,r,u;if(this._eventListeners&&(i=this._eventListeners[n],i)){for(r={type:n,currentTarget:this,target:this,bubbles:!1,cancelable:!1,eventPhase:0,detail:t,defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0},_stopImmediately:!1,stopImmediatePropagation:function(){this._stopImmediately=!0}},u=0;u<i.length;u++)if(i[u](r),r._stopImmediately)break;return r.defaultPrevented}}},addClass:function(n,t){return n&&$(n).addClass(t),n},hasClass:function(n,t){return n?$(n).hasClass(t):n},toggleClass:function(n,t){return n?$(n).toggleClass(t):n},removeClass:function(n,t){return n&&$(n).removeClass(t),n},query:function(n,t){var i=$(n,t||document).get();return new WinJS.Utilities.QueryCollection(i)},empty:function(n){return n&&$(n).empty(),n}}),window.msSetImmediate=msSetImmediate,setImmediate=msSetImmediate,WinJS.Namespace.define("WinJS.Utilities",{QueryCollection:WinJS.Class.derive(Array,function(n){if(n)if(n.length!==undefined)for(var t=0;t<n.length;t++)this.push(n[t]);else this.push(n)},{setAttribute:function(n,t){return this.forEach(function(i){i.setAttribute(n,t)}),this},get:function(n){if(n<this.length)return this[n]},forEach:function(n,t){if(n)return Array.prototype.forEach.call(this,n,t)},addClass:function(n){return n&&this.forEach(function(t){$(t).addClass(n)}),this},removeClass:function(n){return n&&this.forEach(function(t){$(t).removeClass(n)}),this},listen:function(n,t,i){return n&&t&&this.forEach(function(r){r.addEventListener(n,t,i)}),this},setStyle:function(n,t){return n&&t&&this.forEach(function(i){$(i).css(n,t)}),this},clearStyle:function(n){return n&&this.forEach(function(t){$(t).css(n,"")}),this},id:function(n){if(!n)return null;var t=$("#"+n)[0];return t?new WinJS.Utilities.QueryCollection(t):null},getAttribute:function(n){return this.length==0?undefined:$(this[0]).attr(n)||null}})}),Bluesky={Settings:{ProxyCrossDomainXhrCalls:!0}},blueskyUtils={getHighestZIndex:function(){var n=0;return $("[z-index]").each(function(){n=Math.max(n,$(this).attr("z-index"))}),n},_uniqueControlId:1,setDOMElementUniqueId:function(n){$(n).attr("id","_bs"+this._uniqueControlId++)},convertDeclarativeDataStringToJavascriptObject:function(n){var t,i;n=n.replace("\r","").replace("\n","").trim(),n[n.length-1]==";"&&(n=n.substring(0,n.length-1)),t=n.replace(/([a-zA-z\-0-9\./]+)/g,"'$1'"),t=t.replace(/''/g,"'"),t=t.replace(/' '/g," "),t=t.replace(/'\('/g,"("),t=t.replace(/'\)'/g,")'"),t.trim().indexOf("{")!=0&&(t="{ "+t+" }"),t=t.replace(/;/g,","),t=t.replace(/\'/g,'"');try{i=JSON.parse(t)}catch(r){i=""}return i},ensureDatasetReady:function(n){var t,u,f,e,i,r;if(n.dataset==undefined&&(n.dataset={},n.attributes!=undefined))for(t=0;t<n.attributes.length;t++)if(u=n.attributes[t].name,u.substr(0,5)=="data-"){for(f=u.split("-"),e="",i=1;i<f.length;i++)r=f[i],i>1&&(r=r.substr(0,1).toUpperCase()+r.substr(1)),e+=r;n.dataset[e]=n.attributes[t].value}},removeDuplicateElements:function(n,t,i){var r={};$(n,i).each(function(){var n=$(this).attr(t);r[n]?$(this).remove():r[n]=!0})},shiftPressed:!1,controlPressed:!1,_warnedDoneNYI:!1},$(document).keydown(function(n){blueskyUtils.shiftPressed=n.shiftKey,blueskyUtils.controlPressed=n.ctrlKey}),$(document).keyup(function(n){blueskyUtils.shiftPressed=n.shiftKey,blueskyUtils.controlPressed=n.ctrlKey}),jQuery.extend(jQuery.easing,{def:"easeOut",easeOut:function(n,t,i,r,u){return t=t/u-1,i+r*t*t*t*t*t+1}})