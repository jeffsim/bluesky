/* This Source Code Form is subject to the terms of the Mozilla Public
* License, v. 2.0. If a copy of the MPL was not distributed with this
* file, You can obtain one at http://mozilla.org/MPL/2.0/. */

// Copyright 2012, Jeff Simon (www.bluesky.io).  Date: 7/23/2012

"use strict";function ItemPromise(n){var t={then:function(n){return n(this._value)}};return t._value=n,t}function msSetImmediate(n){WinJS.Promise.timeout().then(function(){n()})}function setImmediate(n){return msSetImmediate(n)}var WinJS={Namespace:{define:function(n,t){return this.defineWithParent(window,n,t)},defineWithParent:function(n,t,i){for(var r=n,e=t.split("."),f,u=0,o=e.length;u<o;u++)f=e[u],r[f]||Object.defineProperty(r,f,{value:{},writable:!1,enumerable:!0,configurable:!0}),r=r[f];return i&&WinJS._initializeMembers(r,i),r}},Class:{define:function(n,t,i){return n=n||function(){},t&&WinJS._initializeMembers(n.prototype,t),i&&WinJS._initializeMembers(n,i),n},derive:function(n,t,i,r){return t=t||function(){},t.prototype=Object.create(n.prototype),Object.defineProperty(t.prototype,"constructor",{value:t}),WinJS.Class.define(t,i,r),t},mix:function(n,t){return t&&WinJS._initializeMembers(n.prototype,t),n}},_initializeMembers:function(n,t){var u={},r,i;for(r in t)(i=t[r],i!=null)&&(i.enumerable=!0,typeof i=="object"&&(typeof i.get=="function"||typeof i.set=="function")?u[r]=i:n[r]=i);u!={}&&Object.defineProperties(n,u)},strictProcessing:function(){}},blueskyUtils;WinJS.Namespace.define("Windows",{UI:{ViewManagement:{ApplicationView:{value:null},ApplicationViewState:{view:{value:this.filled},fullScreenLandscape:0,filled:1,snapped:2,fullScreenPortrait:3}}},ApplicationModel:{isWeb:!0,Activation:{ActivationKind:{launch:0},ApplicationExecutionState:{terminated:0}}},Graphics:{Display:{DisplayProperties:{}}}}),WinJS.Namespace.define("WinJS.Application",{IsBluesky:!0,start:function(){var n=[],t=function(t){n.push(t)},i=this;WinJS.Promise.timeout().then(function(){return i._notifyLoaded({setPromise:t}),n.length>0?WinJS.Promise.join(n):void 0}).then(function(){var r=new WinJS.Promise(function(n){$(document).ready(function(){n()})});return r.then(function(){var r={arguments:"",kind:Windows.ApplicationModel.Activation.ActivationKind.launch,previousExecutionState:null,target:null,setPromise:t,activatedOperation:new Windows.UI.WebUI.ActivatedOperation};return r.detail=[r],n=[],i._notifyActivated(r),n.length>0?WinJS.Promise.join(n):void 0}).then(function(){if(Windows.UI.WebUI._activationDeferrals.length>0)return WinJS.Promise.join(Windows.UI.WebUI._activationDeferrals)}).then(function(){i._notifyReady({setPromise:t})})})},stop:function(){},addEventListener:function(n,t){WinJS.Application._eventListeners[n].push(t)},removeEventListener:function(n,t){for(var r=WinJS.Application._eventListeners[n],i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);return}},_notifyActivated:function(n){var i={target:this,type:"activated",detail:n,setPromise:n.setPromise,getDeferral:Windows.UI.WebUI.ActivatedOperation.getDeferral},t;for(t in this._eventListeners.activated)this._eventListeners.activated[t](i)},_notifyLoaded:function(n){var i={target:this,type:"loaded",setPromise:n.setPromise},t;for(t in this._eventListeners.loaded)this._eventListeners.loaded[t](i)},_notifyReady:function(n){var i={target:this,type:"ready",setPromise:n.setPromise},t;for(t in this._eventListeners.ready)this._eventListeners.ready[t](i)},onactivated:{get:function(){return WinJS.Application._eventListeners.activated},set:function(n){WinJS.Application.addEventListener("activated",n)}},onloaded:{get:function(){return WinJS.Application._eventListeners.loaded},set:function(n){WinJS.Application.addEventListener("loaded",n)}},onready:{get:function(){return WinJS.Application._eventListeners.ready},set:function(n){WinJS.Application.addEventListener("ready",n)}},_eventListeners:{loaded:[],activated:[],ready:[],checkpoint:[],error:[],settings:[],unloaded:[]},sessionState:{}}),WinJS.Namespace.define("WinJS.Navigation",{_init:function(){},navigate:function(n,t){var i=this;return new WinJS.Promise(function(r){var e=null,o=null,f=null,u={location:n,state:t,defaultPrevented:!1};u.setPromise=function(n){e=n},i._notifyBeforeNavigate(u),WinJS.Promise.as(e).then(function(){if(u.defaultPrevented)return!1;u.setPromise=function(n){o=n},i._notifyNavigating(u)}).then(function(){return WinJS.Promise.as(o)}).then(function(){i.curPageInfo&&i.curPageInfo.location!=""&&i.backStack.push(i.curPageInfo),i.curPageInfo=u,u.setPromise=function(n){f=n},i._notifyNavigated(i.curPageInfo),f?WinJS.Promise.as(f).then(function(){r()}):r()})})},back:function(){if(this.backStack.length==0)return new WinJS.Promise.as(null);var t=this.backStack[this.backStack.length-1],n=this;return new WinJS.Promise(function(i){var f=null,e=null,u=null,r={location:t.location,state:t.state,defaultPrevented:!1};r.setPromise=function(n){f=n},n._notifyBeforeNavigate(r),WinJS.Promise.as(f).then(function(){if(r.defaultPrevented)return!1;r.setPromise=function(n){e=n},n._notifyNavigating(r)}).then(function(){return WinJS.Promise.as(e)}).then(function(){n.backStack.pop(),n.forwardStack.push(n.curPageInfo),n.curPageInfo=t,n.curPageInfo.setPromise=function(n){u=n},n._notifyNavigated(n.curPageInfo),u?WinJS.Promise.as(u).then(function(){i()}):i()})})},forward:function(){if(this.forwardStack.length==0)return new WinJS.Promise.as(null);var t=this.forwardStack[this.forwardStack.length-1],n=this;return new WinJS.Promise(function(i){var f=null,e=null,u=null,r={location:t.location,state:t.state,defaultPrevented:!1};r.setPromise=function(n){f=n},n._notifyBeforeNavigate(r),WinJS.Promise.as(f).then(function(){if(r.defaultPrevented)return!1;r.setPromise=function(n){e=n},n._notifyNavigating(r)}).then(function(){return WinJS.Promise.as(e)}).then(function(){n.forwardStack.pop(),n.backStack.push(n.curPageInfo),n.curPageInfo=t,n.curPageInfo.setPromise=function(n){u=n},n._notifyNavigated(n.curPageInfo),u?WinJS.Promise.as(u).then(function(){i()}):i()})})},canGoBack:{get:function(){return this.backStack.length>0}},canGoForward:{get:function(){return this.forwardStack.length>0}},backStack:[],forwardStack:[],curPageInfo:null,addEventListener:function(n,t){this._eventListeners[n].push(t)},removeEventListener:function(n,t){for(var r=this._eventListeners[n],i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);return}},_notifyBeforeNavigate:function(n){var t={target:this,type:"beforenavigate",detail:n},i;for(i in this._eventListeners.beforenavigate)this._eventListeners.beforenavigate[i](t);n.defaultPrevented=t.defaultPrevented},_notifyNavigating:function(n){var i={target:this,type:"navigating",detail:n},t;for(t in this._eventListeners.navigating)this._eventListeners.navigating[t](i)},_notifyNavigated:function(n){var i={target:this,type:"navigated",detail:n},t;for(t in this._eventListeners.navigated)this._eventListeners.navigated[t](i)},onbeforenavigate:{get:function(){return this._eventListeners.beforenavigate},set:function(n){this.addEventListener("beforenavigate",n)}},onnavigating:{get:function(){return this._eventListeners.navigating},set:function(n){this.addEventListener("navigating",n)}},onnavigated:{get:function(){return this._eventListeners.navigated},set:function(n){this.addEventListener("navigated",n)}},_eventListeners:{beforenavigate:[],navigating:[],navigated:[]},history:{get:function(){return{backStack:this.backStack,forwardStack:this.forwardStack,current:this.curPageInfo?this.curPageInfo.location:""}},set:function(n){n&&n!={}?(this.backStack=n.backStack?n.backStack.slice():[],this.forwardStack=n.forwardStack?n.forwardStack.slice():[],this.curPageInfo.location=n.current&&n.current.location?n.current.location:""):(this.backStack=[],this.forwardStack=[],this.curPageInfo=null)}},location:{get:function(){return this.curPageInfo?this.curPageInfo.location:null},set:function(n){this.curPageInfo.location=n}},state:{get:function(){return this.curPageInfo.state},set:function(n){this.curPageInfo.state=n}}}),WinJS.Namespace.define("WinJS",{Promise:WinJS.Class.define(function(n){this._thenPromises=[],this._completed=!1,this._completedWithError=!1,this._completedValue=null,this._onThenComplete=null,this._onThenError=null,this._onThenProgress=null,this._thenCompletes=[];var i=this;n(function(n){i._complete(n)},function(n){i._error(n)},function(n){i._progress(n)})},{then:function(n,t,i){if(!n)return this._completedValue;if(this._completed)return new WinJS.Promise.as(n(this._completedValue));if(this._completedWithError)return t?new WinJS.Promise.as(t(this._completedValue)):this._completedValue;var r=new WinJS.Promise(function(){});return r._thenComplete=n,r._thenError=t,r._thenProgress=i,this._thenPromises.push(r),r},_complete:function(n){this._completed=!0,this._completedValue=n,this._thenPromises.forEach(function(t){var r=t._thenComplete(n),i=WinJS.Promise.as(r);i&&i.then(function(n){t._complete(n)})})},_error:function(n){this._completedWithError=!0,this._completedValue=n,this._thenPromises.forEach(function(t){if(t._thenError){var r=t._thenError(n),i=WinJS.Promise.as(r);i&&i.then(function(n){t._error(n)},function(n){t._error(n)})}})},done:function(n,t,i){return console.warn("Promise.done is NYI; replacing with .then()"),this.then(n,t,i)}},{timeout:function(n){return n||(n=1),new WinJS.Promise(function(t){setTimeout(t,n)})},as:function(n){return WinJS.Promise.is(n)?n:new WinJS.Promise(function(t){t(n)})},is:function(n){return n&&n.then&&typeof n.then=="function"},join:function(n){return new WinJS.Promise(function(t){var u=[],f,e;n?(n.length||(n=[n]),f=n.length,e=function(){--f==0&&t(u)},n.forEach(function(n){n.then(function(t){u.push(t),e(n)})})):t(u)})}})}),WinJS.Namespace.defineWithParent(WinJS,"Binding",{as:function(n){if(typeof n=="object"){var t=WinJS.Binding.define(n);return new t(n)}return n},define:function(n){var t=WinJS.Class.define(function(n){this.sourceData=n||{};for(var t in n)try{this.sourceData[t]=n[t]}catch(i){}},{bind:function(n,t){return(this.listeners[n]=this.listeners[n]||[],this.listeners[n].indexOf(t)>=0)?this:(this.listeners[n].push(t),this)},getProperty:function(n){return WinJS.Binding.as(this.sourceData[n])},setProperty:function(n,t){return this.updateProperty(n,t),this},updateProperty:function(n,t){var r=this.sourceData[n],i=WinJS.Binding.unwrap(t);return i==r?WinJS.Promise.as():(this.sourceData[n]=i,this.notify(n,i,r))},notify:function(n,t,i){if(!this.listeners[n])return WinJS.Promise.as();var r=this;return WinJS.Promise.timeout().then(function(){r.listeners[n].forEach(function(n){n(t,i)})}).then(function(){return t})},sourceData:{},listeners:{}});return WinJS.Class.mix(t,WinJS.Binding.expandProperties(n)),t},unwrap:function(n){return n&&n.sourceData?n.sourceData:n},expandProperties:function(n){for(var t={};n;)Object.keys(n).forEach(function(n){t[n]={get:function(){return this.getProperty(n)},set:function(t){return this.setProperty(n,t)},enumerable:!0,configurable:!0}}),n=Object.getPrototypeOf(n);return t},processAll:function(n,t){return new WinJS.Promise(function(i){$("[data-win-bind]",n).each(function(){var n,i;blueskyUtils.ensureDatasetReady(this),n=blueskyUtils.convertDeclarativeDataStringToJavascriptObject(this.dataset.winBind);for(i in n)WinJS.Binding._bindField(this,i,n[i],t)}),i()})},_bindField:function(n,t,i,r){if(r.bind!=undefined){var u=n;r.bind(i,function(){WinJS.Binding._updateBoundValue(u,t,r[i])})}WinJS.Binding._updateBoundValue(n,t,r[i])},_updateBoundValue:function(n,t,i){if(t.indexOf(".")>=0){var r=t.split(".");n[r[0]][r[1]]=i}else t=="innerText"&&(t="textContent"),n[t]=i}}),WinJS.Namespace.define("WinJS.Binding",{_ListBase:WinJS.Class.define(function(){},{getAt:function(n){return this.getItem(n).data},_getValues:function(){for(var t=[],i,n=0;n<this.length;n++)i=this.getItem(n),i&&(t[n]=this.getItem(n).data);return t},concat:function(n){return this._getValues().concat(n)},join:function(n){return this._getValues().join(n||",")},forEach:function(n,t){this._getValues().forEach(n,t)},map:function(n,t){return this._getValues().map(n,t)},some:function(n,t){return this._getValues().some(n,t)},every:function(n,t){return this._getValues().every(n,t)},reduce:function(n,t){return this._getValues().reduce(n,t)},reduceRight:function(n,t){return this._getValues().reduceRight(n,t)},indexOf:function(n,t){return this._getValues().indexOf(n,t)},lastIndexOf:function(n,t){var i=this._getValues();return t===undefined&&(t=i.length-1),i.lastIndexOf(n,t)},slice:function(n,t){return this._getValues().slice(n,t)},filter:function(n,t){return this._getValues().filter(n,t)},createFiltered:function(n){return new WinJS.Binding.FilteredListProjection(this,n)},createGrouped:function(n,t){return new WinJS.Binding.GroupedSortedListProjection(this,n,t)},copyItem:function(n){return{key:n.key,data:n.data,groupKey:n.groupKey,groupSize:n.groupSize}},addEventListener:function(n,t){this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push(t)},removeEventListener:function(n,t){for(var r=this._eventListeners[n],i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);return}},_notifyItemChanged:function(n){var i={target:this,type:"itemchanged",detail:n},t;for(t in this._eventListeners.itemchanged)this._eventListeners.itemchanged[t](i)},_notifyItemRemoved:function(n){var i={target:this,type:"itemremoved",detail:n},t;for(t in this._eventListeners.itemremoved)this._eventListeners.itemremoved[t](i)},_notifyItemInserted:function(n){var i={target:this,type:"iteminserted",detail:n},t;for(t in this._eventListeners.iteminserted)this._eventListeners.iteminserted[t](i)},oniteminserted:{get:function(){return this._eventListeners.iteminserted},set:function(n){this.addEventListener("iteminserted",n)}},onitemchanged:{get:function(){return this._eventListeners.itemchanged},set:function(n){this.addEventListener("itemchanged",n)}},onitemremoved:{get:function(){return this._eventListeners.itemremoved},set:function(n){this.addEventListener("itemremoved",n)}},onitemmoved:{get:function(){return this._eventListeners.itemmoved},set:function(n){this.addEventListener("itemmoved",n)}},onreload:{get:function(){return this._eventListeners.reload},set:function(n){this.addEventListener("reload",n)}},onitemmutated:{get:function(){return this._eventListeners.itemmutated},set:function(n){this.addEventListener("itemmutated",n)}}})}),WinJS.Namespace.define("WinJS.Binding",{_ModifiableListBase:WinJS.Class.derive(WinJS.Binding._ListBase,null,{push:function(n){var t=this._addValue(n);this._notifyItemInserted({key:t,index:this.length,value:n})},pop:function(){var n=this.splice(-1,1);return n&&n.length>=1?n[0]:null},shift:function(){return this.splice(0,1)[0]},_getNewKey:function(){return this._currentKey++}})}),WinJS.Namespace.define("WinJS.Binding",{List:WinJS.Class.derive(WinJS.Binding._ModifiableListBase,function(n,t){if(this._eventListeners={itemremoved:[],iteminserted:[],itemchanged:[],itemmoved:[],itemmutated:[],reload:[]},this._items={},this._keys=[],this._currentKey=0,n)for(var i in n)this._addValue(n[i]);WinJS.UI.setOptions(t),this.dataSource=WinJS.Binding.as(this._items),this.dataSource._list=this},{splice:function(n,t){var s=[],o,f,u,r;for(n<0&&(n+=this.length);t>0;){var e=this._keys[n],h=this._items[e],c=h.data;this._keys.splice(n,1),s.push(c),this._notifyItemRemoved({key:e,value:c,item:h,index:n}),delete this._items[e],t--}if(arguments.length>2)for(r=2;r<arguments.length;r++)o=arguments[r],this.binding&&(value=WinJS.Binding.as(value)),f=Math.min(n+r-2,this.length),u=this._getNewKey(),this._items[u]={key:u,data:o,index:f},this._keys.splice(f,0,u),this._notifyItemInserted({key:u,index:f,value:o});for(r=n;r<this.length;r++)this.getItem(r).index=r;return s},_spliceAtKey:function(n){var i=Array.prototype.slice.call(arguments);return i[0]=this._keys.indexOf(n),this.splice.apply(this,i)},shift:function(){return this.splice(0,1)[0]},indexOfKey:function(n){return this._keys.indexOf(n)},_addValue:function(n){var t=this._getNewKey();return this.binding&&(n=WinJS.Binding.as(n)),this._items[t]={key:t,data:n,index:this._keys.length},this._keys.push(t),t},setAt:function(n,t){if(n==this.length)this.push(t);else if(n<this.length){this.binding&&(t=WinJS.Binding.as(t));var r=this._keys[n],u=this._items[r],i=this.copyItem(u);i.data=t,i.index=n,this._items[r]=i,this._notifyItemChanged({key:r,index:n,oldValue:u.data,newValue:t,oldItem:u,newItem:i})}},length:{get:function(){return this._keys.length},set:function(n){n<this._keys.length&&this.splice(n,this._keys.length-n)}},getItem:function(n){return this.getItemFromKey(this._keys[n])},getItemFromKey:function(n){return this._items[n]}})}),WinJS.Namespace.define("WinJS.Binding",{_ListProjection:WinJS.Class.derive(WinJS.Binding._ModifiableListBase,null,{getItemFromKey:function(n){return this._list._items[n]},splice:function(n){var r=Array.prototype.slice.call(arguments);return n==this.length||n==-1?(r[0]=this._list.length-1,this._list.splice.apply(this._list,r)):(r[0]=this.getItem(n).key,this._spliceAtKey.apply(this,r))}})}),WinJS.Namespace.define("WinJS.Binding",{FilteredListProjection:WinJS.Class.derive(WinJS.Binding._ListProjection,function(n,t){var i,r;for(this._filteredKeys=[],this._list=n,this._currentKey=0,this._inclusionCallback=t,i=0;i<n.length;i++)r=n.getItem(i),t(r.data)&&this._filteredKeys.push(r.key);this._eventListeners=[],this._list.addEventListener("iteminserted",this._itemInserted.bind(this)),this._list.addEventListener("itemremoved",this._itemRemoved.bind(this)),this._list.addEventListener("itemchanged",this._itemChanged.bind(this)),this.dataSource=WinJS.Binding.as(this._filteredKeys),this.dataSource._list=this},{indexOf:function(n){return this._filteredKeys.indexOf(n.key)},length:{get:function(){return this._filteredKeys.length}},getItem:function(n){return this.getItemFromKey(this._filteredKeys[n])},getItemFromKey:function(n){return this._list.getItemFromKey(n)},_spliceAtKey:function(n,t){var r,u,i,o;if(arguments.length>2&&(r=Array.prototype.slice.call(arguments),r[1]=0,this._list._spliceAtKey.apply(this._list,r)),u=[],t){var f=[],e=this._filteredKeys.indexOf(n),s=this._filteredKeys.length&&i-e<t;for(i=e;i<s;i++)f.push(this._filteredKeys[i]);o=this._list,f.forEach(function(n){u.push(o._spliceAtKey(n,1)[0])})}return u},setAt:function(n,t){var i=this._list.indexOfKey(this._filteredKeys[n]);this._list.setAt(i,t)},indexOfKey:function(n){return this._filteredKeys.indexOf(n)},_itemInserted:function(n){var i,r,t,u,f;if(this._inclusionCallback(n.detail.value)){for(r=n.detail.index;--r>=0;)if(t=this._list.getItem(r),t&&this._inclusionCallback(t.data)){i=t.key;break}u=i!==undefined?this._filteredKeys.indexOf(i)+1:0,this._filteredKeys.splice(u,0,n.detail.key),f={value:n.detail.value,key:n.detail.key,index:u},this._notifyItemInserted(f)}},_itemRemoved:function(n){var i=n.detail.key,t=this._filteredKeys.indexOf(i);t>=0&&(this._filteredKeys.splice(t,1),this._notifyItemRemoved(n.detail))},_itemChanged:function(n){this._notifyItemChanged(n.detail)}})}),WinJS.Namespace.define("WinJS.Binding",{GroupedSortedListProjection:WinJS.Class.derive(WinJS.Binding._ListProjection,function(n,t,i){var r,u;for(this._groupedItems=[],this._groupsProjection=null,this._sortedKeys=[],this._list=n,this._eventListeners=[],this._groupKeySelector=t,this._groupDataSelector=i,this._list.addEventListener("iteminserted",this._itemInserted.bind(this)),this._list.addEventListener("itemremoved",this._itemRemoved.bind(this)),this._list.addEventListener("itemchanged",this._itemChanged.bind(this)),this._sortedKeys=[],r=0;r<n.length;r++)u=n.getItem(r),this._sortedKeys.push(u.key);for(this._sortKeys(),r=0;r<n.length;r++)u=n.getItem(r),u=this.copyItem(u),u.groupKey=t(u.data),this._addItem(u);this.dataSource=WinJS.Binding.as(this._groupedItems),this.dataSource._list=this},{indexOf:function(n){return this._sortedKeys.indexOf(n.key)},_sortKeys:function(){var n=this;this._sortedKeys.sort(function(t,i){return(t=n._groupKeySelector(n._list.getItemFromKey(t).data),i=n._groupKeySelector(n._list.getItemFromKey(i).data),t<i)?-1:t==i?0:1})},_addItem:function(n){var t=this._groupKeySelector(n.data),i={data:n.data,groupKey:t,key:n.key};this._groupedItems[n.key]=i},length:{get:function(){return this._sortedKeys.length}},getItem:function(n){var t=this._sortedKeys[n];return this.getItemFromKey(t)},getItemFromKey:function(n){return this._groupedItems[n]},indexOfKey:function(n){return this._sortedKeys.indexOf(n)},_itemInserted:function(n){this._addItem({data:n.detail.value,key:n.detail.key}),this._sortedKeys.push(n.detail.key),this._sortKeys(),n.detail.index=this.indexOfKey(n.detail.key),this._notifyItemInserted(n.detail)},_itemRemoved:function(n){var t=n.detail.key,r=n.detail.value,f=n.detail.item,u=this._groupedItems[t],i=this._sortedKeys.indexOf(t);delete this._groupedItems[t],this._sortedKeys.splice(i,1),this._notifyItemRemoved({key:t,value:r,index:i,item:u})},_itemChanged:function(n){var t=n.detail.key,u=n.detail.newValue,i=this._groupedItems[t],r={key:i.key,data:u,groupKey:this._groupKeySelector(u),groupSize:i.groupSize},f;this._groupedItems[t]=r,i.groupKey===r.groupKey?this._notifyItemChanged({key:t,index:this.indexOfKey(t),oldValue:i.data,newValue:r.data,oldItem:i,newItem:r}):(f=this._sortedKeys.indexOf(t),this._sortedKeys.splice(f,1),this._notifyItemRemoved({key:t,value:i.data,index:f,item:i}),this._sortedKeys.push(t),this._sortKeys(),this._notifyItemInserted({key:t,index:this.indexOfKey(t),value:u}))},groups:{get:function(){return this._groupsProjection==null&&(this._groupsProjection=new WinJS.Binding.GroupsListProjection(this)),this._groupsProjection}}})}),WinJS.Namespace.define("WinJS.Binding",{GroupsListProjection:WinJS.Class.derive(WinJS.Binding._ListProjection,function(n){var t,r;for(this._list=n,this._groupItems=[],this._groupKeys=[],this._eventListeners=[],this._list.addEventListener("iteminserted",this._itemInserted.bind(this)),this._list.addEventListener("itemremoved",this._itemRemoved.bind(this)),t=0;t<n.length;t++){var u=n.getItem(t),i=u.groupKey,f=!1;for(r in this._groupItems)if(this._groupItems[r].key==i){this._groupItems[r].groupSize++,f=!0;break}f||(this._groupItems[i]={key:i,groupSize:1,data:n._groupDataSelector(u.data)},this._groupKeys.push(i))}this.dataSource=WinJS.Binding.as(this._groupItems),this.dataSource._list=this},{_itemInserted:function(n){var t=this._list.getItemFromKey(n.detail.key).groupKey,r=this._groupItems[t],i;r?r.groupSize++:(this._groupKeys.push(t),this._sortKeys(),i={key:t,groupSize:1,data:this._list._groupDataSelector(n.value)},this._groupItems[t]=i,this._notifyItemInserted({key:i.key,value:i.data}))},_itemRemoved:function(n){var i=n.detail.item.groupKey,t=this._groupItems[i],r=this._groupKeys.indexOf(i);t.groupSize==1?(this._groupKeys.splice(r,1),delete this._groupItems[i],this._notifyItemRemoved(i,r,t.data,t)):(t.groupSize--,this._notifyItemChanged(i,r,t.data,t.data,t,t))},_sortKeys:function(){var n=this;this._groupKeys.sort(function(n,t){return n<t?-1:n==t?0:1})},length:{get:function(){return this._groupKeys.length}},getItem:function(n){var t=this._groupKeys[n];return this.getItemFromKey(t)},getItemFromKey:function(n){for(var t in this._groupItems)if(this._groupItems[t].key==n)return this._groupItems[t];return null},indexOfKey:function(n){return this._groupKeys.indexOf(n)}})}),WinJS.Namespace.define("WinJS.Binding",{Template:WinJS.Class.define(function(n,t){n||(n=$("<div><\/div>")[0]),this.element=n,t&&WinJS.UI.setOptions(this,t)},{render:function(n,t){var i=this,r=function(n,i){var r=$(t||"<div><\/div>"),u;return r.addClass("win-template"),u=$(n).clone(),WinJS.Binding.processAll(u,i).then(function(){return r.append(u.children()),r[0]})},u=new WinJS.Promise(function(n){i.href?$.get(i.href,function(t){n('<div data-win-control="WinJS.Binding.Template">'+t+"<\/div>")}):n(i.element)}),f=Math.max(0,i.processTimeout||0),e=WinJS.Promise.timeout(f).then(function(){return n}).then(function(n){return u.then(function(t){return r(t,n).then(function(n){return n})})});return{element:this.element,renderComplete:e}},renderItem:function(n,t){var i=n.then(function(n){return n.data});return this.render(i,t)}})}),WinJS.Namespace.define("WinJS.UI",{setOptions:function(n,t){var i,r;if(t)for(i in t)r=t[i],i.toLowerCase().indexOf("on")==0&&n.addEventListener?typeof r=="function"?n.addEventListener(i.substr(2),r):n.addEventListener(i.substr(2),eval(r)):n[i]=t[i]},process:function(n){return new WinJS.Promise(function(t){blueskyUtils.ensureDatasetReady(n),n.dataset&&n.dataset.winControl&&(WinJS.UI._processElement(n),setTimeout(function(){t(n.winControl)},0))})},processAll:function(n){return new WinJS.Promise(function(t){n||(n=document),$("[data-win-control]",n).each(function(){blueskyUtils.ensureDatasetReady(this),WinJS.UI._processElement(this)}),setTimeout(function(){t()},0)})},_processElement:function(n){var t;if(!n.winControl){var u=n.dataset.winOptions?blueskyUtils.convertDeclarativeDataStringToJavascriptObject(n.dataset.winOptions):null,r=n.dataset.winControl.split("."),i=window;for(t=0;t<r.length;t++)i=i[r[t]];n.winControl=new i(n,u),n.winControl.element=n}}}),WinJS.Namespace.define("WinJS.UI.Animation",{enterPage:function(n,t){return this.enterContent(n,t)},exitPage:function(n,t){return this.exitContent(n,t)},enterContent:function(n){return new WinJS.Promise(function(t){var u=0,f;n.length||(n=[n]),f=n.length,n.forEach(function(n){if(n){var i=$(n);i.offset({left:i.offset().left+WinJS.UI.Animation._enterExitDistance}),i.css("opacity","0.5"),i.delay(u).animate({opacity:"1",left:0},150,function(){--f==0&&t&&t()}),u+=WinJS.UI.Animation._staggerDelay}})})},exitContent:function(n){return new WinJS.Promise(function(t){var u=0,f;n.length||(n=[n]),f=n.length,n.forEach(function(n){if(n){var i=$(n);i.offset({left:i.offset().left}),i.delay(u).animate({opacity:"0",left:-WinJS.UI.Animation._enterExitDistance},100,function(){--f==0&&t&&t()}),u+=WinJS.UI.Animation._staggerDelay}})})},_staggerDelay:50,_enterExitDistance:20}),WinJS.Namespace.define("WinJS.UI",{BaseControl:WinJS.Class.define(function(n){this.$rootElement=$(n),this.isYielding=!1,this._eventListeners={},n.winControl=this,this.element=n},{render:function(n){if(n){this._doRender(),this.isYielding=!1;return}if(!this.isYielding){this.isYielding=!0;var t=this;return new WinJS.Promise(function(n){setTimeout(function(){t.isYielding&&(t._doRender(),t.isYielding=!1),n()},0)})}},forceLayout:function(){this.render()},addEventListener:function(n,t){this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push({listener:t})},removeEventListener:function(n,t){if(this._eventListeners[n]){var i=this._eventListeners[n].indexOf(t);i!=-1&&this._eventListeners[n].splice(i,1)}}})}),WinJS.Namespace.define("WinJS.UI.Pages",{render:function(n,t,i,r){t=t||$("<div><\/div>")[0];var u=this.get(n),f=new u(t,i,null,r);return f.renderPromise},get:function(n){var t=WinJS.UI.Pages.registeredPages[n.toLowerCase()];return t=t||WinJS.UI.Pages.define(n)},define:function(n,t){var r=this.registeredPages[n.toLowerCase()],i;return i=r?r:WinJS.Class.define(function(t,i,r,u){var e=WinJS.UI.Pages.registeredPages[n.toLowerCase()],f=this;u&&u.then(function(){f.ready&&f.ready(t,i),f.updateLayout&&f.updateLayout(t,i,null),f.processed&&f.processed(t,i)}),this.renderPromise=this._loadPage({Uri:n,element:t}).then(function(n){return f._processPage(n)}),u||(this.renderPromise=this.renderPromise.then(function(n){return new WinJS.Promise(function(r){f.ready&&f.ready(t,i),f.updateLayout&&f.updateLayout(t,i,null),f.processed&&f.processed(t,i),r(n)})}))},{_loadPage:function(n){var t=this;return new WinJS.Promise(function(i){var r=!1;r||t._getRemotePage(n,i)})},_getRemotePage:function(n,t){$.get(n.Uri,function(i){n.response=i,t(n)})},_processPage:function(n){return new WinJS.Promise(function(t){var e=document.createElement("div"),i,u,r;e.innerHTML=n.response,i=$(e).css({position:"absolute",visibility:"hidden",display:"block"}),$("script",document).each(function(n,t){$("script[src='"+t.attributes.src.value+"']",i).remove()}),$("link[href^='//Microsoft'], link[href^='//microsoft']",i).remove(),$("script[src^='http://Microsoft'], script[src^='http://microsoft']",i).remove(),u=document.styleSheets.length,$(n.element).addClass("pagecontrol"),$(n.element).append(i),r=$("head",document),$("meta, title",i).prependTo(r),$("link, script",i).appendTo(r),blueskyUtils.removeDuplicateElements("style","src",r),$("title:not(:first)",r).remove(),WinJS.UI.processAll(i[0]),$("[id]").each(function(n,t){window[t.id]=t});var f=document.styleSheets.length-u,o=0,s=window.setInterval(function(){var e=0,r;try{for(r=0;r<f;r++)document.styleSheets[u+r].cssRules!=undefined&&e++}catch(h){}o+=50,o>2e3&&(console.warn("Failed to load all style sheets and/or scripts in under 2 seconds; check network log and ensure all stylesheets are valid."),e=f),e==f&&(window.clearInterval(s),i.contents().show().appendTo(n.element),t(n))},50)})},renderPromise:null}),i=WinJS.Class.mix(i,t),this.registeredPages[n.toLowerCase()]=i,i},registeredPages:[]}),WinJS.Namespace.define("WinJS.UI",{HtmlControl:WinJS.Class.define(function(n,t,i){WinJS.UI.Pages.render(t.uri,n,t).then(i)})}),WinJS.Namespace.define("WinJS.UI",{Rating:WinJS.Class.derive(WinJS.UI.BaseControl,function(n,t){n=n||$("<div><\/div>")[0],WinJS.UI.BaseControl.call(this,n,t),this._eventListeners={onchange:[],onpreviewchange:[],oncancel:[]},this._mouseDown=!1,this._overClickedStar=null,this.enableClear=!0,this.averageRating=0,this.disabled=!1,this.maxRating=5,WinJS.UI.setOptions(this,t),this.render(!0)},{_doRender:function(){var n,i,r,t;for(this.$rootElement.empty().addClass("win-rating").attr("role","slider"),n=0;n<this.maxRating;n++)i=this.userRating?n<this.userRating?"win-full win-user":"win-empty":n<this.averageRating?"win-full":"win-empty",r=this.tooltipStrings?this.tooltipStrings[n]:n+1,t=$('<div class="win-star '+i+'" style="float:left" title='+r+"><\/div>").data("index",n),this.$rootElement.append(t),t.mousemove(this.handleMouseMove.bind(this)),t.click(this.handleMouseClick.bind(this));this.$rootElement.append("<div style='clear:both'><\/div>"),this.$rootElement.mouseleave(this.handleMouseLeave.bind(this)).mousedown(function(){this.winControl._mouseDown=!0}).mouseup(function(){this.winControl._mouseDown=!1})},handleMouseLeave:function(n){if(!this.disabled){if(this._overClickedStar=null,this.enableClear&&this._mouseDown){var t=n.clientX-$(n.currentTarget).offset().left;t<=0&&(this.userRating=null)}this._notifyCancel({target:{winControl:this},type:"cancel"}),this.render()}},handleMouseClick:function(n){var t,i;this.disabled||(t={tentativeRating:this.userRating,target:{winControl:this},type:"previewchange",preventDefault:!1},this._notifyPreviewChange(t),t.preventDefault)||(i=$(n.currentTarget).data("index"),this._overClickedStar=i,this.userRating=i+1,t.type="change",t.tentativeRating=this.userRating,t.userRating=this.userRating,this._notifyChange(t))},handleMouseMove:function(n){if(!this.disabled){var t=$(n.currentTarget);if(this._overClickedStar){if(this._overClickedStar==t.data("index"))return;this._overClickedStar=null}t.siblings().removeClass("win-user win-full").addClass("win-empty"),t.removeClass("win-empty win-user win-full").addClass("win-full win-tentative"),t.prevAll().removeClass("win-empty win-user win-full").addClass("win-full win-tentative")}},_notifyChange:function(n){for(var t in this._eventListeners.onchange)this._eventListeners.onchange[t].listener(n)},_notifyPreviewChange:function(n){for(var t in this._eventListeners.onpreviewchange)this._eventListeners.onpreviewchange[t].listener(n)},_notifyCancel:function(n){for(var t in this._eventListeners.oncancel)this._eventListeners.oncancel[t].listener(n)},_userRating:null,userRating:{get:function(){return this._userRating},set:function(n){this._userRating=n,this.render()}},_averageRating:null,averageRating:{get:function(){return this._averageRating},set:function(n){this._averageRating=n,this.render()}},_maxRating:null,maxRating:{get:function(){return this._maxRating},set:function(n){this._maxRating=n,this.render()}},_tooltipStrings:null,tooltipStrings:{get:function(){return this._tooltipStrings},set:function(n){this._tooltipStrings=n,this.render()}}})}),WinJS.Namespace.define("WinJS.UI",{FlipView:WinJS.Class.derive(WinJS.UI.BaseControl,function(n,t){WinJS.UI.BaseControl.call(this,n,t),t&&(t.orientation&&(this.orientation=t.orientation.toLowerCase()),t.itemSpacing&&(this.itemSpacing=t.itemSpacing),t.itemDataSource&&(this.itemDataSource=eval(t.itemDataSource)),t.itemTemplate&&(this.itemTemplate=document.getElementById(t.itemTemplate)),t.currentPage&&(this.currentPage=t.currentPage)),msSetImmediate(function(){this.currentPage==-1&&(this.currentPage=0)})},{_doRender:function(){var f,i,e,r,t,o,u;if(this.itemDataSource||this.itemTemplate){this.$rootElement.empty().addClass("win-flipview").attr("role","listbox").css("overflow","hidden"),this._items=[];var h=this.$rootElement.outerWidth(),c=this.$rootElement.outerHeight(),n=$("<div style='width:100%;height:100%;position:relative;z-index: 0;'><\/div>");for(n.append($('<div tabindex="0" aria-hidden="true"><\/div>')),this.orientation=="horizontal"?(n.append($('<button tabindex="-1" class="win-navbutton win-navleft" aria-hidden="true" style="display:none; z-index: 1000; font-weight:800" type="button">&lt;<\/button>')),n.append($('<button tabindex="-1" class="win-navbutton win-navright" aria-hidden="false" style=" display:none;z-index: 1000; font-weight:800" type="button">&gt;<\/button>'))):(n.append($('<button tabindex="-1" class="win-navbutton win-navtop" aria-hidden="true" style="display:none; z-index: 1000; font-weight:800" type="button">^<\/button>')),n.append($('<button tabindex="-1" class="win-navbutton win-navbottom" aria-hidden="false" style=" display:none;z-index: 1000; font-weight:800" type="button">v<\/button>'))),n.append($('<div tabindex="0"><\/div>')),f=$('<div class="win-surface" role="group" style="width: 100%; height: 100%; position: relative;">'),this.$itemsContainer=$("<div style='width:100%;height:100%;position:relative;'><\/div>"),i=0;i<this.itemDataSource._list.length;i++){if(e=this.itemDataSource._list.getItem(i),r=$("<div style='width: "+h+"px; height: "+c+"px; position: absolute;'><\/div>").hide(),typeof this.itemTemplate!="function")t=$("<div class='win-item'><\/div>"),o=$(this.itemTemplate).hide().clone().addClass("win-template").show()[0],WinJS.Binding.processAll(o,e.data),t.append(o);else{t=document.createElement("div"),t.className="win-template";var l=this._curItemIndex,s=new WinJS.Promise(function(n){n({data:e.data,index:l})}),u=this;s.then(function(){return u.itemTemplate(s)}).then(function(n){n.element&&(n=n.element),t.appendChild(n)})}r.append(t),this.$itemsContainer.append(r),this._items[i]=r}f.append(this.$itemsContainer),n.append(f),this.$rootElement.append(n),u=this,$(".win-navleft, .win-navtop",this.$rootElement).click(function(){u.previous()}),$(".win-navright, .win-navbottom",this.$rootElement).click(function(){u.next()}),typeof this.currentPage=="undefined"&&(this.currentPage=0),this._makePageVisible(this._currentPage)}},_orientation:"horizontal",orientation:{get:function(){return this._orientation},set:function(n){this._orientation=n,this.render(!0)}},_notifyPageCompleted:function(n){var i={target:this._items[this._currentPage]?$(">div>div",this._items[this._currentPage])[0]:undefined,type:"pagecompleted",detail:n},t;for(t in this._eventListeners.pagecompleted)this._eventListeners.pagecompleted[t](i)},_notifyDataSourceCountChanged:function(){var i={target:this,type:"datasourcecountchanged"},t;for(t in this._eventListeners.datasourcecountchanged)this._eventListeners.datasourcecountchanged[t](i)},_notifyPageSelected:function(n){var i={target:this._items[this._currentPage]?$(">div>div",this._items[this._currentPage])[0]:undefined,type:"pageselected",detail:n},t;for(t in this._eventListeners.pageselected)this._eventListeners.pageselected[t](i)},_notifyPageVisibilityChanged:function(n){var i={type:"pagevisibilitychanged",target:this._items[this._currentPage]?$(">div>div",this._items[this._currentPage])[0]:undefined,srcElement:this._items[this._currentPage]?this._items[this._currentPage][0]:undefined,detail:n},t;for(t in this._eventListeners.pagevisibilitychanged)this._eventListeners.pagevisibilitychanged[t](i)},ondatasourcecountchanged:{get:function(){return this._eventListeners.datasourcecountchanged},set:function(n){this.addEventListener("datasourcecountchanged",n)}},onpagecompleted:{get:function(){return this._eventListeners.pagecompleted},set:function(n){this.addEventListener("pagecompleted",n)}},onpageselected:{get:function(){return this._eventListeners.pageselected},set:function(n){this.addEventListener("pageselected",n)}},onpagevisibilitychanged:{get:function(){return this._eventListeners.pagevisibilitychanged},set:function(n){this.addEventListener("pagevisibilitychanged",n)}},addEventListener:function(n,t){this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push(t),this.element.addEventListener(n,t)},removeEventListener:function(n,t){for(var r=this._eventListeners[n],i=0;i<r.length;i++)if(t===r[i]){r.splice(i,1);return}this.element.removeEventListener(n,t)},next:function(){return this.currentPage==this._items.length-1?!1:(this.currentPage=this.currentPage+1,!0)},previous:function(){return this.currentPage==0?!1:(this.currentPage=this.currentPage-1,!0)},count:function(){if(!this._itemDataSource)return 0;var n=this;return new WinJS.Promise(function(t){t(n._itemDataSource._list.length)})},_currentPage:-1,currentPage:{get:function(){return this._currentPage},set:function(n){if(this._currentPage!=n){var t=this;return this._makePageVisible(n),$(this._items[this._currentPage]).fadeOut("fast"),this._notifyPageVisibilityChanged({source:this.element,visible:!1}),this._currentPage=n,t._notifyPageVisibilityChanged({source:this.element,visible:!0}),this._notifyPageSelected({source:this.element}),WinJS.UI.Animation.enterContent([t._items[t._currentPage]]).then(function(){t._notifyPageCompleted({source:t.element})})}}},_makePageVisible:function(n){n!=-1&&(this._items.length>n&&this._items[n].remove().appendTo(this.$itemsContainer).show(),n>0?$(".win-navleft, .win-navtop",this.$rootElement).show():$(".win-navleft, .win-navtop",this.$rootElement).hide(),n<this._items.length-1?$(".win-navright, .win-navbottom",this.$rootElement).show():$(".win-navright, .win-navbottom",this.$rootElement).hide())},_itemDataSource:null,itemDataSource:{get:function(){return this._itemDataSource},set:function(n){var t=this,u=function(){t.render(!0),t.currentPage=Math.min(t._currentPage,t._itemDataSource._list.length-1)},i=function(){t.render(!0),t.currentPage=Math.min(t._currentPage,t._itemDataSource._list.length-1),t._notifyDataSourceCountChanged()},r;this._itemDataSource&&this._itemDataSource._list&&(this._itemDataSource._list.removeEventListener("itemremoved",i),this._itemDataSource._list.removeEventListener("iteminserted",i),this._itemDataSource._list.removeEventListener("itemchanged",u)),r=this._itemDataSource,this._itemDataSource=n,this._itemDataSource._list.addEventListener("itemremoved",i),this._itemDataSource._list.addEventListener("iteminserted",i),this._itemDataSource._list.addEventListener("itemchanged",u),this.render(),this.currentPage=Math.min(this._currentPage,this._itemDataSource._list.length-1),r&&n._list.length!=r._list.length&&this._notifyDataSourceCountChanged()}},_itemTemplate:null,itemTemplate:{get:function(){return this._itemTemplate},set:function(n){this._itemTemplate=n,this.render()}},_items:[],$itemsContainer:null})}),WinJS.Namespace.define("WinJS.UI",{ListLayout:WinJS.Class.define(function(n){n&&n.groupInfo&&(this.groupInfo=eval(n.groupInfo))},{horizontal:{get:function(){return!1}}})}),WinJS.Namespace.define("WinJS.UI",{GridLayout:WinJS.Class.define(function(n){n&&(n.groupInfo&&(this.groupInfo=eval(n.groupInfo)),this.maxRows=n.maxRows,this.groupHeaderPosition=n.groupHeaderPosition)},{horizontal:{get:function(){return!0}}})}),WinJS.Namespace.define("WinJS.UI",{ListView:WinJS.Class.derive(WinJS.UI.BaseControl,function(n,t){WinJS.UI.BaseControl.call(this,n,t),t&&(t.selectionMode&&(this.selectionMode=t.selectionMode),t.tapBehavior&&(this.tapBehavior=t.tapBehavior),t.swipeBehavior&&(this.swipeBehavior=t.swipeBehavior),t.itemDataSource&&(this.itemDataSource=eval(t.itemDataSource)),t.itemTemplate&&(this.itemTemplate=document.getElementById(t.itemTemplate)||eval(t.itemTemplate)),t.groupDataSource&&(this.groupDataSource=eval(t.groupDataSource)),t.groupHeaderTemplate&&(this.groupHeaderTemplate=document.getElementById(t.groupHeaderTemplate)||eval(t.groupHeaderTemplate)),this.layout=new WinJS.UI.GridLayout(t.layout||{layout:"WinJS.UI.GridLayout",horizontal:!1}))},{_doRender:function(){var r=[],s=[],e,n,u,t;if(this.itemDataSource||this.itemTemplate){e=$("body"),this.$rootElement.empty();var o=this.layout.horizontal?"win-horizontal":"win-vertical",f=$("<div class='win-viewport "+o+"' role='group'><\/div>"),i=$("<div class='win-surface'><\/div>");for(i.css("height",this.$rootElement.outerHeight()),i.css("width",this.$rootElement.outerWidth()),f.append(i),this.$rootElement.append(f),this.$rootElement.css("position","relative").attr("role","listbox").addClass("win-listview"),this._groupDataSource&&this.$rootElement.addClass("win-groups"),t=0;t<this.itemDataSource._list.length;t++)r.push(this.itemDataSource._list.getItem(t));if(n=this,u=[],typeof this.itemTemplate!="function")r.forEach(function(t){n._renderItemTemplate(t)}),u.push(WinJS.Promise.as());else for(t=0;t<r.length;t++)u.push(this._getItemFunctionRenderPromise(r[t],t));WinJS.Promise.join(u).then(function(){for(var o=0,s=0,d=n.$rootElement.outerHeight(),t=0,w=n.layout.groupInfo&&n.layout.groupInfo(),b=null,e,f,l=-1,k=n._getItemMargins(),g=n.layout&&n.layout.groupHeaderPosition=="left",p,v,u,h=0;h<r.length;h++){var a=r[h],y=$(a.element),c=$("<div class='win-container'><\/div>");c.append(y),i.append(c),p=n.layout.horizontal?y.outerWidth():n.$rootElement.outerWidth(),v=y.outerHeight(),w&&w.enableCellSpanning,n._groupDataSource&&a.groupKey!=b?(b=a.groupKey,u=$(n.groupHeaderTemplate).clone().addClass("win-groupheader").show(),WinJS.Binding.processAll(u[0],n._groupDataSource[a.groupKey].data),i.append(u),g?f===undefined?(f=0,e=parseInt(u.css("marginLeft"))+u.outerWidth()+parseInt(u.css("marginRight")),t=e):t+=e:f===undefined?(f=u.outerHeight(),e=parseInt(u.css("marginLeft")),t=e):t+=e,s=f,o=t,l=0,u.css({position:"absolute",top:"0px",left:o-e+"px"})):(f===undefined&&(f=0),n.layout.horizontal&&(s+v>=d||n.layout.maxRows&&l==n.layout.maxRows-1?(s=f,o=t,l=0):l++)),c.css({top:s,left:o,width:p,height:v}),t=Math.max(t,o+p+k.horizontal),s+=v+k.vertical,n.oniteminvoked!=null&&($(".win-item",c).data("itemIndex",h),$(".win-item",c).click(function(){var t=$(this).data("itemIndex");n.oniteminvoked({detail:{itemIndex:t}})}))}i.css("width",t).show(),WinJS.UI.Animation.enterContent([i[0]])})}},_getItemMargins:function(){var n=this.layout.horizontal?"win-horizontal":"win-vertical",t=$("<div class='win-listview'><div class='"+n+"'><div id='_cont1' class='win-container'><\/div><\/div><\/div>").hide().appendTo($("body")),i={vertical:parseInt($("#_cont1").css("marginTop"))+parseInt($("#_cont1").css("marginBottom")),horizontal:parseInt($("#_cont1").css("marginLeft"))+parseInt($("#_cont1").css("marginRight"))};return t.remove(),i},_renderItemTemplate:function(n){n.element=$(this.itemTemplate).clone().addClass("win-item").show()[0],WinJS.Binding.processAll(n.element,n.data)},_getItemFunctionRenderPromise:function(n,t){var i=this;return new WinJS.Promise(function(r){var u=new WinJS.Promise(function(i){i({data:n.data,index:t})});return u.then(function(){return i.itemTemplate(u)}).then(function(t){t.element&&(t=t.element),n.element=t,n.elementWidth=$(n.element).outerWidth(),n.elementHeight=$(n.element).outerHeight(),r()})})},_itemDataSource:null,itemDataSource:{get:function(){return this._itemDataSource},set:function(n){var i=this,t=function(){i.render(!0)};this._itemDataSource&&this._itemDataSource._list&&(this._itemDataSource._list.removeEventListener("itemremoved",t),this._itemDataSource._list.removeEventListener("iteminserted",t),this._itemDataSource._list.removeEventListener("itemchanged",t)),this._itemDataSource=n,this._itemDataSource._list.addEventListener("itemremoved",t),this._itemDataSource._list.addEventListener("iteminserted",t),this._itemDataSource._list.addEventListener("itemchanged",t),this.render()}},_groupDataSource:null,groupDataSource:{get:function(){return this._groupDataSource},set:function(n){var i=this,t=function(){i.render(!0)},r;this._groupDataSource&&this._groupDataSource._list&&(this._groupDataSource._list.removeEventListener("itemremoved",t),this._groupDataSource._list.removeEventListener("iteminserted",t),this._groupDataSource._list.removeEventListener("itemchanged",t)),r=this._groupDataSource,this._groupDataSource=n,this._groupDataSource&&this._groupDataSource._list&&(this._groupDataSource._list.addEventListener("itemremoved",t),this._groupDataSource._list.addEventListener("iteminserted",t),this._groupDataSource._list.addEventListener("itemchanged",t)),this.render()}},_itemTemplate:null,itemTemplate:{get:function(){return this._itemTemplate},set:function(n){this._itemTemplate=n,this.render()}},_layout:null,layout:{get:function(){return this._layout},set:function(n){this._layout=n,this.render()}},oniteminvoked:null,_windowResized:function(){this.render()}})}),WinJS.Namespace.define("Windows.UI.WebUI",{ActivatedOperation:WinJS.Class.define(null,{getDeferral:function(){var n=new Windows.UI.WebUI.ActivatedDeferral;return Windows.UI.WebUI._activationDeferrals.push(n._promise),n}}),ActivatedDeferral:WinJS.Class.define(function(){var n=this;this._promise=new WinJS.Promise(function(t){n.complete=t})},{}),_activationDeferrals:[]}),WinJS.Namespace.define("WinJS.Utilities",{ready:function(n){return new WinJS.Promise(function(t){$(document).ready(function(){n(),t()})})},addClass:function(n,t){return n&&$(n).addClass(t),n},hasClass:function(n,t){return n?$(n).hasClass(t):n},toggleClass:function(n,t){return n?$(n).toggleClass(t):n},removeClass:function(n,t){return n&&$(n).removeClass(t),n},query:function(n,t){var i=$(n,t||document).get();return new WinJS.Utilities.QueryCollection(i)},empty:function(n){return n&&$(n).empty(),n}}),WinJS.Namespace.define("WinJS.Utilities",{QueryCollection:WinJS.Class.derive(Array,function(n){if(n)if(n.length!==undefined)for(var t=0;t<n.length;t++)this.push(n[t]);else this.push(n)},{setAttribute:function(n,t){return this.forEach(function(i){i.setAttribute(n,t)}),this},get:function(n){if(n<this.length)return this[n]},forEach:function(n,t){if(n)return Array.prototype.forEach.call(this,n,t)},addClass:function(n){return n&&this.forEach(function(t){$(t).addClass(n)}),this},removeClass:function(n){return n&&this.forEach(function(t){$(t).removeClass(n)}),this},listen:function(n,t,i){return n&&t&&this.forEach(function(r){r.addEventListener(n,t,i)}),this},setStyle:function(n,t){return n&&t&&this.forEach(function(i){$(i).css(n,t)}),this},clearStyle:function(n){return n&&this.forEach(function(t){$(t).css(n,"")}),this},id:function(n){if(!n)return null;var t=$("#"+n)[0];return t?new WinJS.Utilities.QueryCollection(t):null},getAttribute:function(n){return this.length==0?undefined:$(this[0]).attr(n)||null}})}),blueskyUtils={convertDeclarativeDataStringToJavascriptObject:function(n){var t,i;n=n.replace("\r","").replace("\n","").trim(),t=n.replace(/([a-zA-z\-0-9\./]+)/g,"'$1'"),t=t.replace(/''/g,"'"),t=t.replace(/' '/g," "),t=t.replace(/'\('/g,"("),t=t.replace(/'\)'/g,")'"),t.trim().indexOf("{")!=0&&(t="{ "+t+" }"),t=t.replace(/;/g,","),t=t.replace(/\'/g,'"');try{i=JSON.parse(t)}catch(r){i=""}return i},ensureDatasetReady:function(n){var t,u,f,e,i,r;if(n.dataset==undefined&&(n.dataset={},n.attributes!=undefined))for(t=0;t<n.attributes.length;t++)if(u=n.attributes[t].name,u.substr(0,5)=="data-"){for(f=u.split("-"),e="",i=1;i<f.length;i++)r=f[i],i>1&&(r=r.substr(0,1).toUpperCase()+r.substr(1)),e+=r;n.dataset[e]=n.attributes[t].value}},removeDuplicateElements:function(n,t,i){var r={};$(n,i).each(function(){var n=$(this).attr(t);r[n]?$(this).remove():r[n]=!0})},_getCssNumericValue:function(n,t){return n.css(t).replace(/[^-\d\.]/g,"")}}